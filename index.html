<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SprintFlow â€” Kanban Board</title>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'%3E%3Crect x='4' y='4' width='24' height='24' rx='4' fill='%23f0fdf4' stroke='%2310b981' stroke-width='2'/%3E%3Crect x='8' y='9' width='5' height='14' rx='1' fill='%2310b981' opacity='0.3'/%3E%3Crect x='14' y='9' width='5' height='10' rx='1' fill='%2310b981' opacity='0.5'/%3E%3Crect x='20' y='9' width='5' height='6' rx='1' fill='%2310b981' opacity='0.8'/%3E%3C/svg%3E">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&family=JetBrains+Mono:wght@500&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        :root {
            --slate-50: #f8fafc;
            --slate-100: #f1f5f9;
            --slate-200: #e2e8f0;
            --slate-300: #cbd5e1;
            --slate-400: #94a3b8;
            --slate-500: #64748b;
            --slate-600: #475569;
            --slate-700: #334155;
            --slate-800: #1e293b;
            --slate-900: #0f172a;
            --white: #ffffff;

            --red-50: #fef2f2;
            --red-100: #fee2e2;
            --red-500: #ef4444;
            --red-600: #dc2626;

            --orange-50: #fff7ed;
            --orange-100: #ffedd5;
            --orange-500: #f97316;
            --orange-600: #ea580c;

            --green-50: #f0fdf4;
            --green-100: #dcfce7;
            --green-500: #22c55e;
            --green-600: #16a34a;

            --blue-50: #eff6ff;
            --blue-100: #dbeafe;
            --blue-500: #3b82f6;
            --blue-600: #2563eb;

            --purple-50: #faf5ff;
            --purple-100: #f3e8ff;
            --purple-500: #a855f7;
            --purple-600: #9333ea;

            --accent: #10b981;
            --accent-light: #d1fae5;
            --accent-dark: #0d9668;

            --radius-sm: 8px;
            --radius-md: 12px;
            --radius-lg: 16px;

            --shadow-sm: 0 1px 2px rgba(0,0,0,0.04);
            --shadow-md: 0 4px 12px rgba(0,0,0,0.08);
            --shadow-lg: 0 12px 32px rgba(0,0,0,0.12);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'DM Sans', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            color: var(--slate-700);
            line-height: 1.5;
            min-height: 100vh;
            -webkit-font-smoothing: antialiased;
        }

        /* Header */
        .header {
            background: var(--white);
            border-bottom: 1px solid var(--slate-200);
            padding: 0.75rem 1.5rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: sticky;
            top: 0;
            z-index: 100;
            backdrop-filter: blur(12px);
            background: rgba(255,255,255,0.95);
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 0.875rem;
        }

        .logo {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--green-50) 0%, var(--accent-light) 100%);
            border: 2px solid var(--accent);
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            box-shadow: 0 2px 8px rgba(16, 185, 129, 0.2);
        }

        .logo svg {
            width: 22px;
            height: 22px;
            color: var(--accent);
        }

        .header-text h1 {
            font-size: 1.125rem;
            font-weight: 700;
            color: var(--slate-800);
            letter-spacing: -0.03em;
        }

        .header-text p {
            font-size: 0.6875rem;
            color: var(--slate-500);
            font-weight: 500;
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        /* Save Indicator */
        .save-indicator {
            display: flex;
            align-items: center;
            gap: 0.375rem;
            padding: 0.375rem 0.75rem;
            font-size: 0.75rem;
            font-weight: 500;
            color: var(--accent);
            background: var(--accent-light);
            border-radius: 9999px;
            transition: all 0.3s ease;
        }

        .save-indicator.saving {
            color: var(--orange-600);
            background: var(--orange-100);
        }

        .save-indicator svg {
            width: 14px;
            height: 14px;
        }

        .save-indicator.saving svg {
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        /* Buttons */
        .btn {
            padding: 0.5rem 0.875rem;
            font-size: 0.8125rem;
            font-weight: 600;
            font-family: inherit;
            border: none;
            border-radius: var(--radius-sm);
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.375rem;
            transition: all 0.2s ease;
            white-space: nowrap;
        }

        .btn svg {
            width: 15px;
            height: 15px;
            flex-shrink: 0;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--accent) 0%, var(--accent-dark) 100%);
            color: var(--white);
            box-shadow: 0 2px 8px rgba(16, 185, 129, 0.25);
        }

        .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.35);
        }

        .btn-secondary {
            background: var(--white);
            color: var(--slate-600);
            border: 1.5px solid var(--slate-200);
        }

        .btn-secondary:hover {
            background: var(--slate-50);
            border-color: var(--slate-300);
        }

        .btn-ghost {
            background: transparent;
            color: var(--slate-500);
        }

        .btn-ghost:hover {
            background: var(--slate-100);
            color: var(--slate-700);
        }

        .btn-sm {
            padding: 0.375rem 0.625rem;
            font-size: 0.75rem;
        }

        /* Sprint Bar */
        .sprint-bar {
            background: var(--white);
            border-bottom: 1px solid var(--slate-200);
            padding: 0.875rem 1.5rem;
            display: flex;
            align-items: center;
            gap: 1.5rem;
            flex-wrap: wrap;
        }

        .sprint-info {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            cursor: pointer;
            padding: 0.375rem 0.625rem;
            margin: -0.375rem -0.625rem;
            border-radius: var(--radius-sm);
            transition: all 0.2s ease;
        }

        .sprint-info:hover {
            background: var(--slate-50);
        }

        .sprint-info:hover .edit-hint {
            opacity: 1;
        }

        .sprint-info-text {
            display: flex;
            flex-direction: column;
            gap: 0.125rem;
        }

        .sprint-name-row {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .edit-hint {
            width: 14px;
            height: 14px;
            color: var(--slate-400);
            opacity: 0;
            transition: opacity 0.2s ease;
        }

        .sprint-icon {
            width: 38px;
            height: 38px;
            background: linear-gradient(135deg, var(--accent-light) 0%, var(--green-100) 100%);
            border-radius: var(--radius-sm);
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: var(--shadow-sm);
        }

        .sprint-icon svg {
            width: 18px;
            height: 18px;
            color: var(--accent);
        }

        .sprint-name {
            font-size: 0.9375rem;
            font-weight: 700;
            color: var(--slate-800);
        }

        .sprint-dates {
            font-size: 0.75rem;
            color: var(--slate-500);
            font-weight: 500;
        }

        .sprint-stats {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-left: auto;
            flex-wrap: wrap;
        }

        .stat-item {
            text-align: center;
            padding: 0.5rem 1rem;
            background: var(--slate-50);
            border-radius: var(--radius-sm);
            border: 1px solid var(--slate-100);
            min-width: 70px;
            transition: all 0.2s ease;
        }

        .stat-item.clickable {
            cursor: pointer;
        }

        .stat-item.clickable:hover {
            background: var(--accent-light);
            border-color: var(--accent);
            transform: translateY(-1px);
        }

        .stat-value {
            font-size: 1.125rem;
            font-weight: 700;
            color: var(--slate-800);
            font-family: 'JetBrains Mono', monospace;
        }

        .stat-label {
            font-size: 0.625rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--slate-400);
        }

        /* Capacity Bar */
        .capacity-container {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.625rem 1rem;
            background: var(--white);
            border: 1.5px solid var(--slate-200);
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-sm);
            transition: all 0.2s ease;
        }

        .capacity-container.clickable {
            cursor: pointer;
        }

        .capacity-container.clickable:hover {
            border-color: var(--accent);
            box-shadow: var(--shadow-md);
        }
        }

        .capacity-label {
            font-size: 0.6875rem;
            font-weight: 700;
            text-transform: uppercase;
            color: var(--slate-400);
            letter-spacing: 0.04em;
        }

        .capacity-bar {
            width: 120px;
            height: 10px;
            background: var(--slate-100);
            border-radius: 5px;
            overflow: hidden;
            position: relative;
        }

        .capacity-fill {
            height: 100%;
            border-radius: 5px;
            transition: width 0.5s ease, background 0.3s ease;
        }

        .capacity-fill.under { background: linear-gradient(90deg, var(--accent) 0%, #34d399 100%); }
        .capacity-fill.warning { background: linear-gradient(90deg, var(--orange-500) 0%, #fb923c 100%); }
        .capacity-fill.over { background: linear-gradient(90deg, var(--red-500) 0%, #f87171 100%); }

        .capacity-text {
            font-size: 0.8125rem;
            font-weight: 700;
            min-width: 100px;
            font-family: 'JetBrains Mono', monospace;
        }

        .capacity-text.under { color: var(--accent); }
        .capacity-text.warning { color: var(--orange-600); }
        .capacity-text.over { color: var(--red-600); }

        /* Project Selector */
        .project-selector {
            position: relative;
        }

        .project-selector-btn {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 0.75rem;
            background: transparent;
            border: 1.5px solid transparent;
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .project-selector-btn:hover {
            background: var(--slate-50);
            border-color: var(--slate-200);
        }

        .project-selector-btn .project-name {
            font-size: 1rem;
            font-weight: 700;
            color: var(--slate-800);
            cursor: pointer;
            padding: 0.125rem 0.25rem;
            margin: -0.125rem -0.25rem;
            border-radius: 4px;
            transition: all 0.15s ease;
        }

        .project-selector-btn .project-name:hover {
            background: var(--accent-light);
            color: var(--accent-dark);
        }

        .project-selector-btn .edit-hint-small {
            width: 12px;
            height: 12px;
            color: var(--slate-300);
            opacity: 0;
            transition: opacity 0.2s ease;
        }

        .project-selector-btn:hover .edit-hint-small {
            opacity: 1;
        }

        .project-selector-btn .dropdown-arrow {
            width: 16px;
            height: 16px;
            color: var(--slate-400);
        }

        .project-dropdown {
            min-width: 260px;
            left: 0;
            right: auto;
        }

        .dropdown-item.danger {
            color: var(--red-500);
        }

        .dropdown-item.danger:hover {
            background: var(--red-50);
            color: var(--red-600);
        }

        .dropdown-item.danger svg {
            color: var(--red-400);
        }

        .dropdown-item.danger:hover svg {
            color: var(--red-500);
        }

        .dropdown-header {
            padding: 0.5rem 0.875rem;
            font-size: 0.6875rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--slate-400);
        }

        .dropdown-divider {
            height: 1px;
            background: var(--slate-100);
            margin: 0.375rem 0;
        }

        .project-item {
            display: flex;
            align-items: center;
            gap: 0.625rem;
            width: 100%;
            padding: 0.625rem 0.875rem;
            font-size: 0.8125rem;
            font-weight: 500;
            color: var(--slate-600);
            background: transparent;
            border: none;
            cursor: pointer;
            transition: all 0.15s ease;
            text-align: left;
        }

        .project-item:hover {
            background: var(--slate-50);
            color: var(--slate-800);
        }

        .project-item.active {
            background: var(--accent-light);
            color: var(--accent-dark);
        }

        .project-item .project-icon {
            width: 32px;
            height: 32px;
            background: var(--slate-100);
            border-radius: var(--radius-sm);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .project-item.active .project-icon {
            background: var(--accent);
        }

        .project-item .project-icon svg {
            width: 16px;
            height: 16px;
            color: var(--slate-500);
        }

        .project-item.active .project-icon svg {
            color: var(--white);
        }

        .project-item-info {
            flex: 1;
        }

        .project-item-name {
            font-weight: 600;
        }

        .project-item-meta {
            font-size: 0.6875rem;
            color: var(--slate-400);
        }

        /* Sprint Tabs */
        .sprint-tabs-container {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0 1.5rem;
            background: var(--white);
            border-bottom: 1px solid var(--slate-200);
        }

        .sprint-tabs {
            display: flex;
            gap: 0.25rem;
            overflow-x: auto;
            padding: 0.5rem 0;
            flex: 1;
        }

        .sprint-tabs::-webkit-scrollbar {
            height: 4px;
        }

        .sprint-tabs::-webkit-scrollbar-thumb {
            background: var(--slate-300);
            border-radius: 2px;
        }

        .sprint-tab {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            font-size: 0.8125rem;
            font-weight: 600;
            color: var(--slate-500);
            background: transparent;
            border: none;
            border-radius: var(--radius-sm);
            cursor: pointer;
            white-space: nowrap;
            transition: all 0.2s ease;
        }

        .sprint-tab:hover {
            background: var(--slate-50);
            color: var(--slate-700);
        }

        .sprint-tab.active {
            background: var(--accent-light);
            color: var(--accent-dark);
        }

        .sprint-tab .sprint-status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }

        .sprint-tab .sprint-status-dot.active { background: var(--green-500); }
        .sprint-tab .sprint-status-dot.planned { background: var(--blue-500); }
        .sprint-tab .sprint-status-dot.completed { background: var(--slate-400); }

        .sprint-tab .sprint-task-count {
            font-size: 0.625rem;
            font-weight: 700;
            padding: 0.125rem 0.375rem;
            background: var(--slate-200);
            border-radius: 999px;
            color: var(--slate-600);
        }

        .sprint-tab.active .sprint-task-count {
            background: var(--accent);
            color: var(--white);
        }

        .sprint-add-btn {
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: transparent;
            border: 1.5px dashed var(--slate-300);
            border-radius: var(--radius-sm);
            color: var(--slate-400);
            cursor: pointer;
            transition: all 0.2s ease;
            flex-shrink: 0;
        }

        .sprint-add-btn:hover {
            border-color: var(--accent);
            background: var(--accent-light);
            color: var(--accent);
        }

        .sprint-add-btn svg {
            width: 16px;
            height: 16px;
        }

        /* Dashboard Modal */
        .dashboard-modal,
        .roadmap-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--slate-50);
            z-index: 200;
            overflow-y: auto;
            transform: translateY(100%);
            transition: transform 0.3s ease;
        }

        .dashboard-modal.active,
        .roadmap-modal.active {
            transform: translateY(0);
        }

        /* Roadmap Specific Styles */
        .roadmap-content {
            padding: 1.5rem;
            max-width: 1400px;
            margin: 0 auto;
        }

        .roadmap-controls {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 1.5rem;
        }

        .roadmap-nav-btn {
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--white);
            border: 1.5px solid var(--slate-200);
            border-radius: var(--radius-sm);
            cursor: pointer;
            color: var(--slate-600);
            transition: all 0.2s ease;
        }

        .roadmap-nav-btn:hover {
            background: var(--slate-50);
            border-color: var(--slate-300);
        }

        .roadmap-nav-btn svg {
            width: 18px;
            height: 18px;
        }

        .roadmap-month {
            font-size: 1.125rem;
            font-weight: 700;
            color: var(--slate-800);
            min-width: 180px;
            text-align: center;
        }

        .roadmap-timeline {
            background: var(--white);
            border: 1.5px solid var(--slate-200);
            border-radius: var(--radius-lg);
            overflow: hidden;
            margin-bottom: 1.5rem;
        }

        .roadmap-header {
            display: grid;
            grid-template-columns: repeat(var(--days-count, 31), minmax(28px, 1fr));
            background: var(--slate-50);
            border-bottom: 1px solid var(--slate-200);
            padding: 0.5rem 0;
            overflow-x: auto;
        }

        .roadmap-day {
            text-align: center;
            font-size: 0.6875rem;
            font-weight: 600;
            color: var(--slate-400);
            padding: 0.25rem;
        }

        .roadmap-day.today {
            color: var(--accent);
        }

        .roadmap-day .day-num {
            font-size: 0.8125rem;
            font-weight: 700;
            color: var(--slate-600);
        }

        .roadmap-day.today .day-num {
            background: var(--accent);
            color: var(--white);
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto;
        }

        .roadmap-day.weekend {
            background: var(--slate-100);
        }

        .roadmap-body {
            position: relative;
            min-height: 200px;
            padding: 1rem;
        }

        .roadmap-hint {
            font-size: 0.75rem;
            color: var(--slate-400);
            text-align: center;
            padding: 0.5rem;
            border-top: 1px solid var(--slate-100);
        }

        .roadmap-hint svg {
            width: 14px;
            height: 14px;
            vertical-align: middle;
            margin-right: 0.25rem;
        }

        .roadmap-sprint-row {
            position: relative;
            height: 48px;
            margin-bottom: 0.5rem;
        }

        .roadmap-sprint-bar {
            position: absolute;
            height: 40px;
            background: linear-gradient(135deg, var(--accent) 0%, #34d399 100%);
            border-radius: var(--radius-sm);
            display: flex;
            align-items: center;
            padding: 0 0.75rem;
            cursor: grab;
            transition: box-shadow 0.2s ease, transform 0.1s ease;
            box-shadow: var(--shadow-sm);
            overflow: hidden;
            white-space: nowrap;
            user-select: none;
        }

        .roadmap-sprint-bar:hover {
            box-shadow: var(--shadow-md);
        }

        .roadmap-sprint-bar.dragging {
            cursor: grabbing;
            box-shadow: var(--shadow-lg);
            opacity: 0.9;
            z-index: 100;
        }

        .roadmap-sprint-bar.active {
            background: linear-gradient(135deg, var(--accent-dark) 0%, var(--accent) 100%);
        }

        .roadmap-sprint-bar.planned {
            background: linear-gradient(135deg, var(--blue-500) 0%, var(--blue-400) 100%);
        }

        .roadmap-sprint-bar.completed {
            background: linear-gradient(135deg, var(--slate-400) 0%, var(--slate-300) 100%);
        }

        .roadmap-sprint-bar.no-dates {
            background: var(--slate-200);
            border: 2px dashed var(--slate-400);
            color: var(--slate-600);
            cursor: pointer;
        }

        /* Resize handles */
        .roadmap-resize-handle {
            position: absolute;
            top: 0;
            bottom: 0;
            width: 14px;
            cursor: ew-resize;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.2s ease;
            z-index: 5;
        }

        .roadmap-sprint-bar:hover .roadmap-resize-handle,
        .roadmap-sprint-bar.resizing .roadmap-resize-handle {
            opacity: 1;
        }

        .roadmap-resize-handle::before {
            content: '';
            width: 4px;
            height: 18px;
            background: rgba(255,255,255,0.4);
            border-radius: 2px;
            transition: background 0.15s ease;
        }

        .roadmap-resize-handle:hover::before {
            background: rgba(255,255,255,0.9);
        }

        .roadmap-resize-handle.left {
            left: 0;
            padding-left: 4px;
            border-radius: var(--radius-sm) 0 0 var(--radius-sm);
        }

        .roadmap-resize-handle.right {
            right: 0;
            padding-right: 4px;
            border-radius: 0 var(--radius-sm) var(--radius-sm) 0;
        }

        .roadmap-sprint-bar.no-dates .roadmap-resize-handle {
            display: none;
        }

        /* Date tooltip shown during drag/resize */
        .roadmap-date-tooltip {
            position: absolute;
            bottom: calc(100% + 6px);
            left: 50%;
            transform: translateX(-50%);
            background: var(--slate-800);
            color: var(--white);
            font-size: 0.75rem;
            font-weight: 600;
            padding: 0.375rem 0.625rem;
            border-radius: var(--radius-sm);
            white-space: nowrap;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.15s ease;
            z-index: 200;
        }

        .roadmap-date-tooltip::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            border: 5px solid transparent;
            border-top-color: var(--slate-800);
        }

        .roadmap-sprint-bar.dragging .roadmap-date-tooltip,
        .roadmap-sprint-bar.resizing .roadmap-date-tooltip {
            opacity: 1;
        }

        .roadmap-sprint-name {
            font-size: 0.8125rem;
            font-weight: 600;
            color: var(--white);
            pointer-events: none;
            flex: 1;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .roadmap-sprint-bar.no-dates .roadmap-sprint-name {
            color: var(--slate-600);
        }

        .roadmap-sprint-tasks {
            font-size: 0.6875rem;
            font-weight: 700;
            background: rgba(255,255,255,0.2);
            padding: 0.125rem 0.375rem;
            border-radius: 999px;
            margin-left: 0.5rem;
            pointer-events: none;
            flex-shrink: 0;
        }

        .roadmap-sprint-bar.no-dates .roadmap-sprint-tasks {
            background: var(--slate-300);
        }

        .roadmap-today-line {
            position: absolute;
            top: 0;
            bottom: 0;
            width: 2px;
            background: var(--red-500);
            z-index: 10;
        }

        .roadmap-today-line::before {
            content: 'Vandaag';
            position: absolute;
            top: -20px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.625rem;
            font-weight: 700;
            color: var(--red-500);
            white-space: nowrap;
        }

        /* Sprint List in Roadmap */
        .roadmap-sprint-list {
            background: var(--white);
            border: 1.5px solid var(--slate-200);
            border-radius: var(--radius-lg);
            padding: 1.25rem;
        }

        .roadmap-list-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1rem;
        }

        .roadmap-list-header h3 {
            font-size: 0.9375rem;
            font-weight: 700;
            color: var(--slate-700);
        }

        .roadmap-sprints {
            display: flex;
            flex-direction: column;
            gap: 0.625rem;
        }

        .roadmap-sprint-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1rem;
            background: var(--slate-50);
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .roadmap-sprint-item:hover {
            background: var(--accent-light);
        }

        .roadmap-sprint-item.active {
            background: var(--accent-light);
            border-left: 3px solid var(--accent);
        }

        .roadmap-sprint-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            flex-shrink: 0;
        }

        .roadmap-sprint-dot.active { background: var(--green-500); }
        .roadmap-sprint-dot.planned { background: var(--blue-500); }
        .roadmap-sprint-dot.completed { background: var(--slate-400); }

        .roadmap-sprint-info {
            flex: 1;
        }

        .roadmap-sprint-title {
            font-weight: 600;
            color: var(--slate-700);
            font-size: 0.875rem;
        }

        .roadmap-sprint-dates {
            font-size: 0.75rem;
            color: var(--slate-400);
        }

        .roadmap-sprint-meta {
            text-align: right;
        }

        .roadmap-sprint-count {
            font-family: 'JetBrains Mono', monospace;
            font-weight: 700;
            font-size: 0.875rem;
            color: var(--slate-600);
        }

        .roadmap-sprint-status {
            font-size: 0.6875rem;
            color: var(--slate-400);
        }

        .roadmap-sprint-actions {
            display: flex;
            gap: 0.25rem;
            opacity: 0;
            transition: opacity 0.2s ease;
        }

        .roadmap-sprint-item:hover .roadmap-sprint-actions {
            opacity: 1;
        }

        .dashboard-header {
            background: var(--white);
            border-bottom: 1px solid var(--slate-200);
            padding: 1rem 1.5rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .dashboard-title {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--slate-800);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .dashboard-header .dashboard-title svg {
            width: 24px;
            height: 24px;
            color: var(--accent);
        }

        .dashboard-close {
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--slate-100);
            border: none;
            border-radius: var(--radius-sm);
            cursor: pointer;
            color: var(--slate-500);
            font-size: 1.25rem;
            transition: all 0.2s ease;
        }

        .dashboard-close:hover {
            background: var(--slate-200);
            color: var(--slate-700);
        }

        .dashboard-content {
            padding: 1.5rem;
            max-width: 1400px;
            margin: 0 auto;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .dashboard-card {
            background: var(--white);
            border: 1.5px solid var(--slate-200);
            border-radius: var(--radius-lg);
            padding: 1.25rem;
        }

        .dashboard-card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1rem;
        }

        .dashboard-card-header .dashboard-card-title {
            margin-bottom: 0;
        }

        .dashboard-add-btn {
            width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--slate-100);
            border: none;
            border-radius: var(--radius-sm);
            color: var(--slate-500);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .dashboard-add-btn:hover {
            background: var(--accent);
            color: var(--white);
        }

        .dashboard-add-btn svg {
            width: 16px;
            height: 16px;
        }

        .dashboard-card-title {
            font-size: 0.875rem;
            font-weight: 700;
            color: var(--slate-600);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .dashboard-card-title svg {
            width: 18px;
            height: 18px;
            color: var(--accent);
        }

        .dashboard-big-number {
            font-size: 2.5rem;
            font-weight: 800;
            font-family: 'JetBrains Mono', monospace;
            color: var(--slate-800);
            line-height: 1;
        }

        .dashboard-big-label {
            font-size: 0.75rem;
            color: var(--slate-400);
            margin-top: 0.375rem;
        }

        .dashboard-progress-bar {
            height: 12px;
            background: var(--slate-100);
            border-radius: 6px;
            overflow: hidden;
            margin: 1rem 0 0.5rem;
        }

        .dashboard-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent) 0%, #34d399 100%);
            border-radius: 6px;
            transition: width 0.5s ease;
        }

        .dashboard-progress-labels {
            display: flex;
            justify-content: space-between;
            font-size: 0.75rem;
            color: var(--slate-500);
        }

        /* Status/Priority Breakdown in Dashboard */
        .status-breakdown,
        .priority-breakdown {
            display: flex;
            flex-direction: column;
            gap: 0.625rem;
        }

        .status-row {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.5rem;
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: all 0.15s ease;
        }

        .status-row:hover {
            background: var(--slate-50);
        }

        .status-row .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            flex-shrink: 0;
        }

        .status-row .status-name {
            flex: 1;
            font-size: 0.8125rem;
            font-weight: 500;
            color: var(--slate-600);
        }

        .status-row .status-bar {
            width: 80px;
            height: 6px;
            background: var(--slate-100);
            border-radius: 3px;
            overflow: hidden;
        }

        .status-row .status-bar-fill {
            height: 100%;
            border-radius: 3px;
            transition: width 0.3s ease;
        }

        .status-row .status-count {
            font-family: 'JetBrains Mono', monospace;
            font-weight: 700;
            font-size: 0.8125rem;
            color: var(--slate-700);
            min-width: 24px;
            text-align: right;
        }

        /* Team Stats in Dashboard */
        .team-stats-list {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .team-stat-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem;
            background: var(--slate-50);
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .team-stat-item:hover {
            background: var(--accent-light);
        }

        .team-stat-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            font-weight: 700;
            color: var(--white);
        }

        .team-stat-info {
            flex: 1;
        }

        .team-stat-name {
            font-weight: 600;
            color: var(--slate-700);
            font-size: 0.875rem;
        }

        .team-stat-meta {
            font-size: 0.75rem;
            color: var(--slate-400);
        }

        .team-stat-bar {
            width: 100px;
            height: 6px;
            background: var(--slate-200);
            border-radius: 3px;
            overflow: hidden;
        }

        .team-stat-bar-fill {
            height: 100%;
            border-radius: 3px;
            transition: width 0.3s ease;
        }

        .team-stat-value {
            font-family: 'JetBrains Mono', monospace;
            font-weight: 700;
            font-size: 0.875rem;
            color: var(--slate-600);
            min-width: 60px;
            text-align: right;
        }

        /* Filter Bar */
        .filter-bar {
            padding: 0.875rem 1.5rem;
            display: flex;
            align-items: flex-start;
            gap: 1.5rem;
            background: var(--slate-50);
            border-bottom: 1px solid var(--slate-200);
        }

        .search-box {
            position: relative;
            width: 220px;
            flex-shrink: 0;
        }

        .search-box input {
            width: 100%;
            padding: 0.5rem 0.875rem 0.5rem 2.25rem;
            font-size: 0.8125rem;
            font-family: inherit;
            color: var(--slate-700);
            background: var(--white);
            border: 1.5px solid var(--slate-200);
            border-radius: var(--radius-sm);
            outline: none;
            transition: all 0.2s ease;
        }

        .search-box input:focus {
            border-color: var(--accent);
            box-shadow: 0 0 0 3px var(--accent-light);
        }

        .search-box input::placeholder {
            color: var(--slate-400);
        }

        .search-box svg {
            position: absolute;
            left: 0.75rem;
            top: 50%;
            transform: translateY(-50%);
            width: 15px;
            height: 15px;
            color: var(--slate-400);
        }

        /* Filter Groups */
        .filter-groups {
            display: flex;
            gap: 1.5rem;
            flex: 1;
            flex-wrap: wrap;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .filter-group-label {
            font-size: 0.625rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.06em;
            color: var(--slate-400);
            padding-left: 0.25rem;
        }

        .filter-group-chips {
            display: flex;
            gap: 0.375rem;
            flex-wrap: wrap;
        }

        /* Epic Chips */
        .filter-chip-epic {
            padding: 0.375rem 0.75rem;
            font-size: 0.75rem;
            font-weight: 600;
            font-family: inherit;
            color: var(--slate-600);
            background: var(--white);
            border: 1.5px solid var(--slate-200);
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            gap: 0.375rem;
            position: relative;
            padding-left: 1.375rem;
        }

        .filter-chip-epic::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 5px;
            border-radius: var(--radius-sm) 0 0 var(--radius-sm);
        }

        .filter-chip-epic:hover {
            border-color: var(--slate-300);
            transform: translateY(-1px);
        }

        .filter-chip-epic.active {
            background: var(--white);
            border-color: var(--slate-400);
            box-shadow: var(--shadow-md);
        }

        /* Team Chips */
        .filter-chip-team {
            padding: 0.3125rem 0.75rem 0.3125rem 0.3125rem;
            font-size: 0.75rem;
            font-weight: 600;
            font-family: inherit;
            color: var(--slate-600);
            background: var(--white);
            border: 1.5px solid var(--slate-200);
            border-radius: 9999px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            gap: 0.375rem;
        }

        .filter-chip-team:hover {
            border-color: var(--slate-300);
            transform: translateY(-1px);
        }

        .filter-chip-team.active {
            background: var(--white);
            border-color: var(--slate-400);
            box-shadow: var(--shadow-md);
        }

        .filter-chip-team .mini-avatar {
            width: 22px;
            height: 22px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.5625rem;
            font-weight: 700;
            color: var(--white);
        }

        /* Status Chips */
        .filter-chip-status {
            padding: 0.3125rem 0.625rem 0.3125rem 0.5rem;
            font-size: 0.75rem;
            font-weight: 600;
            font-family: inherit;
            color: var(--slate-600);
            background: var(--white);
            border: 1.5px solid var(--slate-300);
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .filter-chip-status .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }

        .filter-chip-status .chip-remove {
            font-size: 0.625rem;
            color: var(--slate-400);
            margin-left: 0.125rem;
        }

        .filter-chip-status:hover {
            border-color: var(--red-300);
            background: var(--red-50);
        }

        .filter-chip-status:hover .chip-remove {
            color: var(--red-500);
        }

        .clear-filters-btn {
            padding: 0.375rem 0.75rem;
            font-size: 0.6875rem;
            font-weight: 600;
            color: var(--slate-400);
            background: transparent;
            border: 1.5px dashed var(--slate-300);
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: all 0.2s ease;
            font-family: inherit;
            align-self: flex-end;
        }

        .clear-filters-btn:hover {
            color: var(--red-500);
            border-color: var(--red-300);
            background: var(--red-50);
        }

        /* Board */
        .board-container {
            padding: 1.25rem 1.5rem 2rem;
            overflow-x: auto;
        }

        .board {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 1rem;
            min-height: calc(100vh - 260px);
        }

        @media (max-width: 1400px) {
            .board {
                grid-template-columns: repeat(5, minmax(240px, 1fr));
            }
        }

        /* Columns */
        .column {
            background: var(--white);
            border: 1.5px solid var(--slate-200);
            border-radius: var(--radius-lg);
            display: flex;
            flex-direction: column;
            min-width: 0;
            transition: all 0.3s ease;
            box-shadow: var(--shadow-sm);
        }

        .column.drag-over {
            border-color: var(--accent);
            box-shadow: 0 0 0 3px var(--accent-light), var(--shadow-md);
            transform: scale(1.01);
        }

        .column-header {
            padding: 1rem 1rem 0.875rem;
            border-bottom: 1px solid var(--slate-100);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .column-title {
            display: flex;
            align-items: center;
            gap: 0.625rem;
        }

        .column-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            box-shadow: 0 2px 6px rgba(0,0,0,0.15);
        }

        .column-name {
            font-size: 0.875rem;
            font-weight: 700;
            color: var(--slate-700);
        }

        .column-count {
            font-size: 0.75rem;
            font-weight: 700;
            padding: 0.1875rem 0.625rem;
            border-radius: 9999px;
            background: var(--slate-100);
            color: var(--slate-500);
            font-family: 'JetBrains Mono', monospace;
        }

        .column-cards {
            flex: 1;
            padding: 0.75rem;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 0.625rem;
        }

        /* Cards */
        .card {
            background: var(--white);
            border: 1.5px solid var(--slate-200);
            border-radius: var(--radius-md);
            padding: 0.875rem;
            cursor: grab;
            transition: all 0.25s ease;
            position: relative;
        }

        .card:hover {
            border-color: var(--slate-300);
            box-shadow: var(--shadow-md);
            transform: translateY(-2px);
        }

        .card.dragging {
            opacity: 0.5;
            cursor: grabbing;
            transform: rotate(2deg);
        }

        /* Priority border indicators */
        .card.priority-high {
            border-left: 3px solid var(--red-500);
        }
        .card.priority-medium {
            border-left: 3px solid var(--orange-500);
        }
        .card.priority-low {
            border-left: 3px solid var(--green-500);
        }

        .card-top-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
        }

        .card-epic {
            font-size: 0.625rem;
            font-weight: 700;
            padding: 0.1875rem 0.5rem;
            border-radius: 4px;
            display: inline-block;
            letter-spacing: 0.02em;
            text-transform: uppercase;
        }

        .card-priority-badge {
            font-size: 0.5625rem;
            font-weight: 700;
            padding: 0.125rem 0.375rem;
            border-radius: 3px;
            text-transform: uppercase;
            letter-spacing: 0.03em;
        }

        .card-priority-badge.high {
            background: var(--red-100);
            color: var(--red-600);
        }
        .card-priority-badge.medium {
            background: var(--orange-100);
            color: var(--orange-600);
        }
        .card-priority-badge.low {
            background: var(--green-100);
            color: var(--green-600);
        }

        .card-title {
            font-size: 0.8125rem;
            font-weight: 600;
            color: var(--slate-800);
            margin-bottom: 0.25rem;
            line-height: 1.45;
            padding-right: 1.5rem;
        }

        .card-description {
            font-size: 0.75rem;
            color: var(--slate-500);
            margin-bottom: 0.5rem;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
            line-height: 1.4;
        }

        /* Subtasks Section on Card */
        .card-subtasks-section {
            background: var(--slate-50);
            border-radius: 6px;
            padding: 0.5rem 0.625rem;
            margin: 0.5rem 0;
        }

        .card-subtasks-header {
            display: flex;
            align-items: center;
            gap: 0.375rem;
            font-size: 0.6875rem;
            font-weight: 600;
            color: var(--slate-500);
            margin-bottom: 0.375rem;
        }

        .card-subtasks-header svg {
            width: 12px;
            height: 12px;
            color: var(--slate-400);
        }

        .subtasks-percent {
            margin-left: auto;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.625rem;
            color: var(--slate-400);
        }

        .card-subtasks-bar {
            height: 4px;
            background: var(--slate-200);
            border-radius: 2px;
            overflow: hidden;
        }

        .card-subtasks-fill {
            height: 100%;
            background: var(--accent);
            border-radius: 2px;
            transition: width 0.3s ease;
        }

        .card-subtasks-fill.complete {
            background: var(--green-500);
        }

        /* Card Footer */
        .card-footer {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            margin-top: 0.625rem;
            padding-top: 0.625rem;
            border-top: 1px solid var(--slate-100);
        }

        .card-owner {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .card-owner-avatar {
            width: 22px;
            height: 22px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.5625rem;
            font-weight: 700;
            color: var(--white);
            flex-shrink: 0;
        }

        .card-owner-name {
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--slate-600);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .card-meta-row {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .card-meta {
            display: flex;
            align-items: center;
            gap: 0.25rem;
            font-size: 0.6875rem;
            color: var(--slate-400);
            font-weight: 500;
        }

        .card-meta svg {
            width: 12px;
            height: 12px;
        }

        .card-meta.overdue {
            color: var(--red-500);
            font-weight: 600;
        }

        .card-estimate {
            font-size: 0.6875rem;
            font-weight: 700;
            padding: 0.1875rem 0.5rem;
            border-radius: 4px;
            background: var(--blue-50);
            color: var(--blue-600);
            font-family: 'JetBrains Mono', monospace;
        }

        .card-other-participants {
            display: flex;
            align-items: center;
            gap: 0.25rem;
            margin-left: auto;
        }

        .other-label {
            font-size: 0.625rem;
            color: var(--slate-400);
            font-weight: 500;
        }

        .card-avatar-small {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.5rem;
            font-weight: 700;
            color: var(--white);
            border: 1.5px solid var(--white);
            margin-left: -4px;
        }

        .card-avatar-small:first-of-type {
            margin-left: 0;
        }

        .more-participants {
            font-size: 0.5625rem;
            color: var(--slate-400);
            font-weight: 600;
            margin-left: 0.125rem;
        }

        .card-avatars {
            display: flex;
            margin-left: auto;
        }

        .card-avatar {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.5rem;
            font-weight: 700;
            color: var(--white);
            border: 2px solid var(--white);
            margin-left: -5px;
            box-shadow: var(--shadow-sm);
        }

        .card-avatar:first-child {
            margin-left: 0;
        }

        .card-actions {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            display: flex;
            gap: 0.25rem;
            opacity: 0;
            transition: opacity 0.2s ease;
        }

        .card:hover .card-actions {
            opacity: 1;
        }

        .card-action-btn {
            width: 24px;
            height: 24px;
            border-radius: 6px;
            background: var(--white);
            border: 1px solid var(--slate-200);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--slate-400);
            transition: all 0.2s ease;
        }

        .card-action-btn:hover {
            background: var(--slate-50);
            color: var(--slate-600);
            border-color: var(--slate-300);
        }

        .card-action-btn.delete:hover {
            background: var(--red-50);
            color: var(--red-500);
            border-color: var(--red-200);
        }

        .card-action-btn svg {
            width: 12px;
            height: 12px;
        }

        /* Add Card Button */
        .add-card-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            padding: 0.75rem;
            font-size: 0.8125rem;
            font-weight: 600;
            font-family: inherit;
            color: var(--slate-400);
            background: transparent;
            border: 1.5px dashed var(--slate-200);
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: all 0.2s ease;
            margin-top: 0.25rem;
        }

        .add-card-btn:hover {
            background: var(--accent-light);
            border-color: var(--accent);
            color: var(--accent-dark);
        }

        .add-card-btn svg {
            width: 15px;
            height: 15px;
        }

        /* Modals & Panels */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(15, 23, 42, 0.5);
            backdrop-filter: blur(4px);
            z-index: 200;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        .modal-overlay.active {
            opacity: 1;
            pointer-events: auto;
        }

        .modal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.95);
            background: var(--white);
            border-radius: var(--radius-lg);
            width: 90%;
            max-width: 540px;
            max-height: 90vh;
            overflow: hidden;
            z-index: 201;
            opacity: 0;
            pointer-events: none;
            transition: all 0.3s ease;
            box-shadow: var(--shadow-lg);
        }

        .modal.active {
            opacity: 1;
            pointer-events: auto;
            transform: translate(-50%, -50%) scale(1);
        }

        .modal-header {
            padding: 1.25rem 1.5rem;
            border-bottom: 1px solid var(--slate-100);
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: linear-gradient(135deg, var(--slate-50) 0%, var(--white) 100%);
        }

        .modal-title {
            font-size: 1.0625rem;
            font-weight: 700;
            color: var(--slate-800);
        }

        .modal-close {
            width: 32px;
            height: 32px;
            border: none;
            background: var(--slate-100);
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.25rem;
            color: var(--slate-400);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .modal-close:hover {
            background: var(--red-100);
            color: var(--red-500);
        }

        .modal-body {
            padding: 1.5rem;
            overflow-y: auto;
            max-height: calc(90vh - 140px);
        }

        .modal-footer {
            padding: 1rem 1.5rem;
            border-top: 1px solid var(--slate-100);
            display: flex;
            justify-content: flex-end;
            gap: 0.625rem;
            background: var(--slate-50);
        }

        /* Sidebar Panel */
        .sidebar-overlay {
            position: fixed;
            inset: 0;
            background: rgba(15, 23, 42, 0.5);
            backdrop-filter: blur(4px);
            z-index: 200;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        .sidebar-overlay.active {
            opacity: 1;
            pointer-events: auto;
        }

        .sidebar-panel {
            position: fixed;
            top: 0;
            right: 0;
            width: 420px;
            max-width: 100%;
            height: 100vh;
            background: var(--white);
            z-index: 201;
            transform: translateX(100%);
            transition: transform 0.35s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            flex-direction: column;
            box-shadow: var(--shadow-lg);
        }

        .sidebar-panel.active {
            transform: translateX(0);
        }

        .panel-content {
            padding: 1.5rem;
            overflow-y: auto;
            flex: 1;
        }

        /* Form Elements */
        .form-group {
            margin-bottom: 1.25rem;
        }

        .form-label {
            display: block;
            font-size: 0.8125rem;
            font-weight: 600;
            color: var(--slate-600);
            margin-bottom: 0.5rem;
        }

        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 0.625rem 0.875rem;
            font-size: 0.875rem;
            font-family: inherit;
            color: var(--slate-700);
            background: var(--white);
            border: 1.5px solid var(--slate-200);
            border-radius: var(--radius-sm);
            outline: none;
            transition: all 0.2s ease;
        }

        .form-input:focus, .form-select:focus, .form-textarea:focus {
            border-color: var(--accent);
            box-shadow: 0 0 0 3px var(--accent-light);
        }

        .form-input::placeholder, .form-textarea::placeholder {
            color: var(--slate-400);
        }

        .form-textarea {
            resize: vertical;
            min-height: 80px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .form-hint {
            font-size: 0.6875rem;
            color: var(--slate-400);
            margin-top: 0.375rem;
            font-style: italic;
        }

        /* Estimate Slider */
        .estimate-display {
            font-weight: 700;
            color: var(--accent);
            font-family: 'JetBrains Mono', monospace;
        }

        .estimate-slider-container {
            margin-bottom: 0.75rem;
        }

        .estimate-slider {
            width: 100%;
            height: 8px;
            -webkit-appearance: none;
            appearance: none;
            background: var(--slate-200);
            border-radius: 4px;
            outline: none;
            cursor: pointer;
        }

        .estimate-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            background: linear-gradient(135deg, var(--accent) 0%, var(--accent-dark) 100%);
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 2px 6px rgba(16, 185, 129, 0.4);
            transition: transform 0.15s ease;
        }

        .estimate-slider::-webkit-slider-thumb:hover {
            transform: scale(1.15);
        }

        .estimate-slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            background: linear-gradient(135deg, var(--accent) 0%, var(--accent-dark) 100%);
            border-radius: 50%;
            cursor: pointer;
            border: none;
            box-shadow: 0 2px 6px rgba(16, 185, 129, 0.4);
        }

        .estimate-markers {
            display: flex;
            justify-content: space-between;
            padding: 0.25rem 0.25rem 0;
            font-size: 0.625rem;
            color: var(--slate-400);
            font-family: 'JetBrains Mono', monospace;
        }

        .estimate-input-row {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }

        .estimate-input-label {
            font-size: 0.75rem;
            color: var(--slate-500);
        }

        .estimate-custom-input {
            width: 80px;
            padding: 0.5rem 0.625rem;
            font-size: 0.8125rem;
            font-family: 'JetBrains Mono', monospace;
            color: var(--slate-700);
            background: var(--white);
            border: 1.5px solid var(--slate-200);
            border-radius: var(--radius-sm);
            outline: none;
            transition: all 0.2s ease;
        }

        .estimate-custom-input:focus {
            border-color: var(--accent);
            box-shadow: 0 0 0 3px var(--accent-light);
        }

        .estimate-custom-input::placeholder {
            color: var(--slate-400);
            font-family: 'DM Sans', sans-serif;
        }

        .estimate-input-suffix {
            font-size: 0.75rem;
            color: var(--slate-500);
        }

        /* Estimate Buttons */
        .estimate-options {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .estimate-btn {
            padding: 0.5rem 0.875rem;
            font-size: 0.8125rem;
            font-weight: 600;
            font-family: 'JetBrains Mono', monospace;
            color: var(--slate-500);
            background: var(--slate-50);
            border: 1.5px solid var(--slate-200);
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .estimate-btn:hover {
            background: var(--accent-light);
            border-color: var(--accent);
            color: var(--accent-dark);
        }

        .estimate-btn.active {
            background: var(--accent);
            border-color: var(--accent);
            color: var(--white);
        }

        /* Priority Buttons */
        .priority-options {
            display: flex;
            gap: 0.5rem;
        }

        .priority-btn {
            flex: 1;
            padding: 0.5rem 0.75rem;
            font-size: 0.8125rem;
            font-weight: 600;
            font-family: inherit;
            color: var(--slate-500);
            background: var(--slate-50);
            border: 1.5px solid var(--slate-200);
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.375rem;
        }

        .priority-btn:hover { background: var(--slate-100); }
        .priority-btn.high.active { background: var(--red-50); border-color: var(--red-300); color: var(--red-600); }
        .priority-btn.medium.active { background: var(--orange-50); border-color: var(--orange-300); color: var(--orange-600); }
        .priority-btn.low.active { background: var(--green-50); border-color: var(--green-300); color: var(--green-600); }

        .priority-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }

        .priority-btn.high .priority-dot { background: var(--red-500); }
        .priority-btn.medium .priority-dot { background: var(--orange-500); }
        .priority-btn.low .priority-dot { background: var(--green-500); }

        /* Checklist */
        .checklist-item {
            display: flex;
            align-items: center;
            gap: 0.625rem;
            padding: 0.625rem 0.875rem;
            background: var(--slate-50);
            border-radius: var(--radius-sm);
            margin-bottom: 0.5rem;
            transition: all 0.2s ease;
        }

        .checklist-item.done {
            background: var(--green-50);
        }

        .checklist-item.done span {
            text-decoration: line-through;
            color: var(--slate-400);
        }

        .checklist-item input[type="checkbox"] {
            width: 18px;
            height: 18px;
            accent-color: var(--accent);
        }

        .checklist-item span {
            flex: 1;
            font-size: 0.8125rem;
            color: var(--slate-700);
        }

        /* Item List */
        .item-list {
            display: flex;
            flex-direction: column;
            gap: 0.625rem;
        }

        .item-row {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1rem;
            background: var(--slate-50);
            border-radius: var(--radius-sm);
            transition: all 0.2s ease;
        }

        .item-row:hover {
            background: var(--slate-100);
        }

        .item-color {
            width: 5px;
            height: 32px;
            border-radius: 3px;
            flex-shrink: 0;
        }

        .item-info {
            flex: 1;
        }

        .item-name {
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--slate-700);
        }

        .item-sub {
            font-size: 0.75rem;
            color: var(--slate-400);
        }

        /* Epic Items with Expandable Tasks */
        .epic-item {
            background: var(--slate-50);
            border-radius: var(--radius-sm);
            overflow: hidden;
            transition: all 0.2s ease;
        }

        .epic-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .epic-header:hover {
            background: var(--slate-100);
        }

        .epic-color {
            width: 5px;
            height: 32px;
            border-radius: 3px;
            flex-shrink: 0;
        }

        .epic-info {
            flex: 1;
        }

        .epic-name {
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--slate-700);
        }

        .epic-progress {
            font-size: 0.75rem;
            color: var(--slate-400);
        }

        .epic-actions {
            display: flex;
            align-items: center;
            gap: 0.375rem;
        }

        .expand-icon {
            width: 18px;
            height: 18px;
            color: var(--slate-400);
            transition: transform 0.2s ease;
            margin-left: 0.25rem;
        }

        .epic-item.expanded .expand-icon {
            transform: rotate(180deg);
        }

        .epic-tasks {
            max-height: 0;
            overflow: hidden;
            background: var(--white);
            border-top: 1px solid var(--slate-200);
            transition: max-height 0.3s ease;
        }

        .epic-item.expanded .epic-tasks {
            max-height: 1000px;
        }

        .epic-task-item {
            display: flex;
            align-items: flex-start;
            gap: 0.625rem;
            padding: 0.625rem 1rem 0.625rem 1.5rem;
            cursor: pointer;
            transition: all 0.15s ease;
            border-bottom: 1px solid var(--slate-100);
        }

        .epic-task-item:last-child {
            border-bottom: none;
        }

        .epic-task-item:hover {
            background: var(--slate-50);
        }

        .epic-task-status {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            flex-shrink: 0;
            margin-top: 0.375rem;
        }

        .epic-task-status.status-backlog { background: var(--slate-400); }
        .epic-task-status.status-todo { background: var(--blue-500); }
        .epic-task-status.status-bezig { background: var(--orange-500); }
        .epic-task-status.status-review { background: var(--purple-500); }
        .epic-task-status.status-klaar { background: var(--green-500); }

        .epic-task-info {
            flex: 1;
            min-width: 0;
        }

        .epic-task-title {
            font-size: 0.8125rem;
            font-weight: 500;
            color: var(--slate-700);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .epic-task-meta {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-top: 0.25rem;
            font-size: 0.6875rem;
            color: var(--slate-400);
        }

        .epic-task-status-label {
            padding: 0.125rem 0.375rem;
            background: var(--slate-100);
            border-radius: 3px;
            font-weight: 500;
        }

        .epic-task-owner {
            font-weight: 500;
        }

        .epic-task-estimate {
            font-family: 'JetBrains Mono', monospace;
            font-weight: 600;
            color: var(--blue-600);
        }

        .avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            font-weight: 700;
            color: var(--white);
            flex-shrink: 0;
        }

        /* Team Availability */
        .team-availability {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .availability-input {
            width: 70px;
            padding: 0.375rem 0.5rem;
            font-size: 0.8125rem;
            font-family: 'JetBrains Mono', monospace;
            font-weight: 600;
            color: var(--slate-700);
            background: var(--white);
            border: 1.5px solid var(--slate-200);
            border-radius: var(--radius-sm);
            outline: none;
            text-align: center;
            transition: all 0.2s ease;
        }

        .availability-input:focus {
            border-color: var(--accent);
            box-shadow: 0 0 0 3px var(--accent-light);
        }

        .availability-label {
            font-size: 0.75rem;
            color: var(--slate-400);
            font-weight: 500;
        }

        .availability-sync-btn {
            padding: 0.25rem 0.5rem;
            font-size: 0.6875rem;
            font-weight: 600;
            font-family: inherit;
            color: var(--accent);
            background: var(--accent-light);
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .availability-sync-btn:hover {
            background: var(--accent);
            color: var(--white);
        }

        /* Capacity Section */
        .capacity-section {
            background: linear-gradient(135deg, var(--accent-light) 0%, var(--green-100) 100%);
            border-radius: var(--radius-md);
            padding: 1rem 1.25rem;
            margin-bottom: 1.5rem;
            border: 1px solid var(--green-200);
        }

        .capacity-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 0.75rem;
        }

        .capacity-title {
            font-size: 0.8125rem;
            font-weight: 700;
            color: var(--accent-dark);
        }

        .capacity-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 0.75rem;
        }

        .capacity-stat {
            text-align: center;
            padding: 0.625rem;
            background: rgba(255,255,255,0.8);
            border-radius: var(--radius-sm);
        }

        .capacity-stat-value {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--accent-dark);
            font-family: 'JetBrains Mono', monospace;
        }

        .capacity-stat-label {
            font-size: 0.625rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.04em;
            color: var(--slate-500);
        }

        /* Sprint Duration Link */
        .sprint-duration-link {
            display: flex;
            align-items: center;
            gap: 0.625rem;
            padding: 0.875rem 1rem;
            background: var(--blue-50);
            border: 1.5px solid var(--blue-200);
            border-radius: var(--radius-sm);
            margin-bottom: 1rem;
        }

        .sprint-duration-link svg {
            width: 18px;
            height: 18px;
            color: var(--blue-500);
        }

        .sprint-duration-info {
            flex: 1;
        }

        .sprint-duration-info strong {
            font-size: 0.8125rem;
            color: var(--slate-700);
        }

        .sprint-duration-info p {
            font-size: 0.6875rem;
            color: var(--slate-500);
            margin-top: 0.125rem;
        }

        .sync-all-btn {
            padding: 0.375rem 0.75rem;
            font-size: 0.75rem;
            font-weight: 600;
            font-family: inherit;
            color: var(--blue-600);
            background: var(--white);
            border: 1.5px solid var(--blue-300);
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .sync-all-btn:hover {
            background: var(--blue-600);
            color: var(--white);
            border-color: var(--blue-600);
        }

        /* Participants */
        .participants-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.5rem;
        }

        .participant-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 0.75rem;
            background: var(--slate-50);
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .participant-item:hover {
            background: var(--slate-100);
        }

        .participant-item input[type="checkbox"] {
            accent-color: var(--accent);
        }

        /* Dropdown */
        .dropdown {
            position: relative;
        }

        .dropdown-menu {
            position: absolute;
            top: calc(100% + 6px);
            right: 0;
            min-width: 180px;
            background: var(--white);
            border: 1.5px solid var(--slate-200);
            border-radius: var(--radius-md);
            padding: 0.5rem;
            z-index: 100;
            opacity: 0;
            pointer-events: none;
            transform: translateY(-8px);
            transition: all 0.2s ease;
            box-shadow: var(--shadow-lg);
        }

        .dropdown.active .dropdown-menu {
            opacity: 1;
            pointer-events: auto;
            transform: translateY(0);
        }

        .dropdown-menu.active {
            opacity: 1;
            pointer-events: auto;
            transform: translateY(0);
        }

        .dropdown-item {
            display: flex;
            align-items: center;
            gap: 0.625rem;
            padding: 0.5rem 0.75rem;
            font-size: 0.8125rem;
            font-weight: 500;
            color: var(--slate-600);
            background: none;
            border: none;
            border-radius: var(--radius-sm);
            cursor: pointer;
            width: 100%;
            text-align: left;
            transition: all 0.15s ease;
            font-family: inherit;
        }

        .dropdown-item:hover {
            background: var(--slate-50);
            color: var(--slate-800);
        }

        .dropdown-item svg {
            width: 15px;
            height: 15px;
            color: var(--slate-400);
        }

        .dropdown-item:hover svg {
            color: var(--slate-600);
        }

        /* Add Epic Inline */
        .add-epic-inline {
            display: none;
            gap: 0.5rem;
            margin-top: 0.75rem;
            padding: 0.75rem;
            background: var(--slate-50);
            border-radius: var(--radius-sm);
        }

        .add-epic-inline.active {
            display: flex;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 1.5rem;
            color: var(--slate-400);
            font-size: 0.875rem;
        }

        /* Toast */
        .toast-container {
            position: fixed;
            bottom: 1.5rem;
            right: 1.5rem;
            z-index: 300;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .toast {
            display: flex;
            align-items: center;
            gap: 0.625rem;
            padding: 0.75rem 1rem;
            background: var(--white);
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-lg);
            animation: slideIn 0.3s ease;
            border-left: 4px solid var(--accent);
        }

        .toast.error {
            border-left-color: var(--red-500);
        }

        .toast svg {
            width: 18px;
            height: 18px;
            color: var(--accent);
        }

        .toast.error svg {
            color: var(--red-500);
        }

        .toast span {
            font-size: 0.875rem;
            font-weight: 500;
            color: var(--slate-700);
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .header { flex-wrap: wrap; gap: 0.75rem; }
            .header-actions { width: 100%; justify-content: flex-end; }
            .sprint-bar { flex-direction: column; align-items: flex-start; }
            .sprint-stats { margin-left: 0; width: 100%; justify-content: space-between; }
            .filter-bar { flex-direction: column; }
            .search-box { width: 100%; }
            .sidebar-panel { width: 100%; }
            .form-row { grid-template-columns: 1fr; }
            .participants-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-left">
            <div class="logo">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="3" y="3" width="18" height="18" rx="3"/>
                    <line x1="8" y1="7" x2="8" y2="17"/>
                    <line x1="12" y1="7" x2="12" y2="14"/>
                    <line x1="16" y1="7" x2="16" y2="11"/>
                </svg>
            </div>
            <div class="project-selector">
                <button class="project-selector-btn" onclick="toggleDropdown('projectDropdown')">
                    <span class="project-name" id="activeProjectName" onclick="event.stopPropagation(); editProjectName()">Mijn Project</span>
                    <svg class="edit-hint-small" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>
                    <svg class="dropdown-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 12 15 18 9"/></svg>
                </button>
                <div class="dropdown-menu project-dropdown" id="projectDropdown">
                    <div class="dropdown-header">Projecten</div>
                    <div id="projectList"></div>
                    <div class="dropdown-divider"></div>
                    <button class="dropdown-item" onclick="createNewProject()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
                        Nieuw project
                    </button>
                    <button class="dropdown-item danger" onclick="deleteCurrentProject()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>
                        Project verwijderen
                    </button>
                </div>
            </div>
        </div>
        <div class="header-actions">
            <div class="save-indicator" id="saveIndicator">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                    <polyline points="22 4 12 14.01 9 11.01"/>
                </svg>
                <span>Opgeslagen</span>
            </div>
            <button class="btn btn-secondary" onclick="openPanel('team')">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                    <circle cx="9" cy="7" r="4"/>
                    <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
                    <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
                </svg>
                Team
            </button>
            <button class="btn btn-secondary" onclick="openPanel('epics')">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polygon points="12 2 2 7 12 12 22 7 12 2"/>
                    <polyline points="2 17 12 22 22 17"/>
                    <polyline points="2 12 12 17 22 12"/>
                </svg>
                Epics
            </button>
            <button class="btn btn-secondary" onclick="openPanel('sprint')">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10"/>
                    <polyline points="12 6 12 12 16 14"/>
                </svg>
                Sprint
            </button>
            <button class="btn btn-secondary" onclick="openRoadmap()">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                    <line x1="16" y1="2" x2="16" y2="6"/>
                    <line x1="8" y1="2" x2="8" y2="6"/>
                    <line x1="3" y1="10" x2="21" y2="10"/>
                </svg>
                Roadmap
            </button>
            <div class="dropdown">
                <button class="btn btn-secondary" onclick="toggleDropdown('exportDropdown')">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                        <polyline points="7 10 12 15 17 10"/>
                        <line x1="12" y1="15" x2="12" y2="3"/>
                    </svg>
                    Export
                </button>
                <div class="dropdown-menu" id="exportDropdown">
                    <button class="dropdown-item" onclick="exportAsJSON()" style="border-bottom: 1px solid var(--slate-100); margin-bottom: 0.25rem; padding-bottom: 0.625rem;">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
                        Backup opslaan (JSON)
                    </button>
                    <button class="dropdown-item" onclick="document.getElementById('importFile').click()" style="border-bottom: 1px solid var(--slate-100); margin-bottom: 0.25rem; padding-bottom: 0.625rem;">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>
                        Backup laden (JSON)
                    </button>
                    <input type="file" id="importFile" accept=".json" style="display: none;" onchange="importFromJSON(event)">
                    <button class="dropdown-item" onclick="exportAsJPG()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2"/><circle cx="8.5" cy="8.5" r="1.5"/><polyline points="21 15 16 10 5 21"/></svg>
                        Download als JPG
                    </button>
                    <button class="dropdown-item" onclick="exportAsPDF()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/></svg>
                        Download als PDF
                    </button>
                    <button class="dropdown-item" onclick="exportAsCSV()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>
                        Download als CSV
                    </button>
                </div>
            </div>
            <button class="btn btn-primary" onclick="openCardModal()">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="12" y1="5" x2="12" y2="19"/>
                    <line x1="5" y1="12" x2="19" y2="12"/>
                </svg>
                Nieuwe Taak
            </button>
        </div>
    </header>

    <!-- Sprint Bar -->
    <div class="sprint-bar">
        <div class="sprint-info" onclick="editSprintInline()" title="Klik om sprint te bewerken">
            <div class="sprint-icon">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/>
                </svg>
            </div>
            <div class="sprint-info-text">
                <div class="sprint-name-row">
                    <span class="sprint-name" id="currentSprintName">Sprint 1</span>
                    <svg class="edit-hint" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>
                </div>
                <div class="sprint-dates" id="sprintDates">Geen datums ingesteld</div>
            </div>
        </div>
        <div class="sprint-stats">
            <div class="stat-item clickable" onclick="showTasksOverview('all')" title="Bekijk alle taken">
                <div class="stat-value" id="statTotalTasks">0</div>
                <div class="stat-label">Totaal</div>
            </div>
            <div class="stat-item clickable" onclick="showTasksOverview('done')" title="Bekijk voltooide taken">
                <div class="stat-value" id="statCompletedTasks">0</div>
                <div class="stat-label">Klaar</div>
            </div>
            <div class="capacity-container clickable" onclick="openDashboard()" title="Bekijk statistieken dashboard">
                <span class="capacity-label">Capaciteit</span>
                <div class="capacity-bar">
                    <div class="capacity-fill under" id="capacityFill" style="width: 0%"></div>
                </div>
                <span class="capacity-text under" id="capacityText">0 / 0 dagen</span>
            </div>
        </div>
    </div>

    <!-- Sprint Tabs -->
    <div class="sprint-tabs-container">
        <div class="sprint-tabs" id="sprintTabs">
            <!-- Sprint tabs worden hier dynamisch gegenereerd -->
        </div>
        <button class="sprint-add-btn" onclick="createNewSprint()" title="Nieuwe sprint">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
        </button>
    </div>

    <!-- Filter Bar -->
    <div class="filter-bar">
        <div class="search-box">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="11" cy="11" r="8"/>
                <line x1="21" y1="21" x2="16.65" y2="16.65"/>
            </svg>
            <input type="text" id="searchInput" placeholder="Zoeken..." oninput="filterCards()">
        </div>
        <div class="filter-groups">
            <div class="filter-group" id="statusFilterGroup" style="display: none;">
                <span class="filter-group-label">Status</span>
                <div class="filter-group-chips" id="statusFilterChips"></div>
            </div>
            <div class="filter-group" id="epicFilterGroup" style="display: none;">
                <span class="filter-group-label">Epics</span>
                <div class="filter-group-chips" id="epicFilterChips"></div>
            </div>
            <div class="filter-group" id="teamFilterGroup" style="display: none;">
                <span class="filter-group-label">Team</span>
                <div class="filter-group-chips" id="teamFilterChips"></div>
            </div>
        </div>
        <button class="clear-filters-btn" id="clearFiltersBtn" onclick="clearAllFilters()" style="display: none;">
            âœ• Filters wissen
        </button>
    </div>

    <!-- Board -->
    <div class="board-container">
        <div class="board" id="board"></div>
    </div>

    <!-- Card Modal -->
    <div class="modal-overlay" id="cardModalOverlay" onclick="closeCardModal()"></div>
    <div class="modal" id="cardModal">
        <div class="modal-header">
            <h3 class="modal-title" id="cardModalTitle">Nieuwe Taak</h3>
            <button class="modal-close" onclick="closeCardModal()">Ã—</button>
        </div>
        <div class="modal-body">
            <input type="hidden" id="cardId">
            <div class="form-group">
                <label class="form-label">Titel *</label>
                <input type="text" class="form-input" id="cardTitle" placeholder="Wat moet er gedaan worden?">
            </div>
            <div class="form-group">
                <label class="form-label">Beschrijving</label>
                <textarea class="form-textarea" id="cardDescription" placeholder="Voeg details toe..."></textarea>
            </div>
            <div class="form-group">
                <label class="form-label">Subtaken</label>
                <div id="subtasksContainer"></div>
                <div style="display: flex; gap: 0.5rem; margin-top: 0.5rem;">
                    <input type="text" class="form-input" id="newSubtaskInput" placeholder="Nieuwe subtaak...">
                    <button class="btn btn-secondary" onclick="addSubtask()">+</button>
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">Epic</label>
                    <select class="form-select" id="cardEpicSelect" onchange="handleEpicSelect(this)"></select>
                    <div class="add-epic-inline" id="addEpicInline">
                        <input type="text" class="form-input" id="inlineEpicName" placeholder="Epic naam...">
                        <input type="color" id="inlineEpicColor" value="#a855f7" style="width: 36px; height: 36px; border: 1.5px solid var(--slate-200); border-radius: var(--radius-sm); cursor: pointer; padding: 2px;">
                        <button class="btn btn-primary btn-sm" onclick="addEpicInline()">+</button>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Status</label>
                    <select class="form-select" id="cardStatus">
                        <option value="backlog">Backlog</option>
                        <option value="todo">Te Doen</option>
                        <option value="bezig">Bezig</option>
                        <option value="review">Review</option>
                        <option value="klaar">Klaar</option>
                    </select>
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">Eigenaar</label>
                    <select class="form-select" id="cardOwnerSelect" onchange="onOwnerChange(this.value)"></select>
                </div>
                <div class="form-group">
                    <label class="form-label">Deadline</label>
                    <input type="text" class="form-input" id="cardDueDate" placeholder="dd/mm/jjjj">
                </div>
            </div>
            <div class="form-group">
                <label class="form-label">Betrokkenen</label>
                <div class="participants-grid" id="participantsContainer"></div>
            </div>
            <div class="form-group">
                <label class="form-label">Prioriteit</label>
                <div class="priority-options">
                    <button type="button" class="priority-btn high" onclick="setPriority('high')">
                        <span class="priority-dot"></span>
                        Hoog
                    </button>
                    <button type="button" class="priority-btn medium" onclick="setPriority('medium')">
                        <span class="priority-dot"></span>
                        Middel
                    </button>
                    <button type="button" class="priority-btn low" onclick="setPriority('low')">
                        <span class="priority-dot"></span>
                        Laag
                    </button>
                </div>
            </div>
            <div class="form-group">
                <label class="form-label">Inschatting (mensdagen): <span id="estimateDisplay" class="estimate-display">-</span></label>
                <div class="estimate-slider-container">
                    <input type="range" class="estimate-slider" id="cardEstimateSlider" min="0" max="40" step="0.5" value="0" oninput="updateEstimateFromSlider(this.value)">
                    <div class="estimate-markers">
                        <span>0</span>
                        <span>10</span>
                        <span>20</span>
                        <span>30</span>
                        <span>40</span>
                    </div>
                </div>
                <div class="estimate-input-row">
                    <span class="estimate-input-label">Of voer exact in:</span>
                    <input type="number" class="estimate-custom-input" id="estimateCustomInput" placeholder="bv. 2.5" min="0" max="100" step="0.5" oninput="setEstimateFromInput(this.value)">
                    <span class="estimate-input-suffix">dagen</span>
                </div>
                <input type="hidden" id="cardEstimate" value="">
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-ghost" onclick="closeCardModal()">Annuleren</button>
            <button class="btn btn-primary" onclick="saveCard()">Opslaan</button>
        </div>
    </div>

    <!-- Team Panel -->
    <div class="sidebar-overlay" id="teamOverlay" onclick="closePanel('team')"></div>
    <div class="sidebar-panel" id="teamPanel">
        <div class="modal-header">
            <h3 class="modal-title">Teamleden</h3>
            <button class="modal-close" onclick="closePanel('team')">Ã—</button>
        </div>
        <div class="panel-content">
            <div class="form-group">
                <label class="form-label">Nieuw teamlid toevoegen</label>
                <div style="display: flex; gap: 0.5rem;">
                    <input type="text" class="form-input" id="newMemberName" placeholder="Naam..." style="flex: 1;">
                    <input type="color" id="newMemberColor" value="#10b981" style="width: 40px; height: 38px; border: 1.5px solid var(--slate-200); border-radius: var(--radius-sm); cursor: pointer; padding: 2px;">
                    <button class="btn btn-primary" onclick="addTeamMember()">+</button>
                </div>
                <div class="form-hint">Druk op Enter of klik + om toe te voegen</div>
            </div>
            <div class="item-list" id="teamList"></div>
        </div>
    </div>

    <!-- Epics Panel -->
    <div class="sidebar-overlay" id="epicsOverlay" onclick="closePanel('epics')"></div>
    <div class="sidebar-panel" id="epicsPanel">
        <div class="modal-header">
            <h3 class="modal-title">Epics</h3>
            <button class="modal-close" onclick="closePanel('epics')">Ã—</button>
        </div>
        <div class="panel-content">
            <div class="form-group">
                <label class="form-label">Nieuwe epic toevoegen</label>
                <div style="display: flex; gap: 0.5rem;">
                    <input type="text" class="form-input" id="newEpicName" placeholder="Epic naam..." style="flex: 1;">
                    <input type="color" id="newEpicColor" value="#a855f7" style="width: 40px; height: 38px; border: 1.5px solid var(--slate-200); border-radius: var(--radius-sm); cursor: pointer; padding: 2px;">
                    <button class="btn btn-primary" onclick="addEpic()">+</button>
                </div>
                <div class="form-hint">Druk op Enter of klik + om toe te voegen</div>
            </div>
            <div class="item-list" id="epicsList"></div>
        </div>
    </div>

    <!-- Sprint Panel -->
    <div class="sidebar-overlay" id="sprintOverlay" onclick="closePanel('sprint')"></div>
    <div class="sidebar-panel" id="sprintPanel">
        <div class="modal-header">
            <h3 class="modal-title">Sprint Instellingen</h3>
            <button class="modal-close" onclick="closePanel('sprint')">Ã—</button>
        </div>
        <div class="panel-content">
            <!-- Capacity Overview -->
            <div class="capacity-section">
                <div class="capacity-header">
                    <span class="capacity-title">Sprint Capaciteit</span>
                </div>
                <div class="capacity-stats">
                    <div class="capacity-stat">
                        <div class="capacity-stat-value" id="panelCapacityTotal">0</div>
                        <div class="capacity-stat-label">Beschikbaar</div>
                    </div>
                    <div class="capacity-stat">
                        <div class="capacity-stat-value" id="panelCapacityUsed">0</div>
                        <div class="capacity-stat-label">Ingepland</div>
                    </div>
                    <div class="capacity-stat">
                        <div class="capacity-stat-value" id="panelCapacityRemaining">0</div>
                        <div class="capacity-stat-label">Resterend</div>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label class="form-label">Sprint Naam</label>
                <input type="text" class="form-input" id="sprintNameInput" placeholder="Sprint 1">
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">Startdatum</label>
                    <input type="text" class="form-input" id="sprintStartInput" placeholder="dd/mm/jjjj">
                </div>
                <div class="form-group">
                    <label class="form-label">Einddatum</label>
                    <input type="text" class="form-input" id="sprintEndInput" placeholder="dd/mm/jjjj">
                </div>
            </div>
            <div class="form-group">
                <label class="form-label">Werkdagen in sprint</label>
                <input type="number" class="form-input" id="sprintDaysInput" placeholder="10" min="1" max="60" step="0.5" onchange="onSprintDaysChange()">
                <div class="form-hint">Aantal werkdagen (excl. weekenden/feestdagen). Dit bepaalt de standaard beschikbaarheid per teamlid.</div>
            </div>
            <div class="form-group">
                <label class="form-label">Sprint Doel</label>
                <textarea class="form-textarea" id="sprintGoalInput" placeholder="Wat wil je bereiken deze sprint?"></textarea>
            </div>
            <button class="btn btn-primary" onclick="saveSprint()" style="width: 100%;">Sprint Opslaan</button>

            <div style="margin-top: 1.5rem; padding-top: 1.5rem; border-top: 1px solid var(--slate-200);">
                <div class="sprint-duration-link">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                        <circle cx="9" cy="7" r="4"/>
                        <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
                        <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
                    </svg>
                    <div class="sprint-duration-info">
                        <strong>Team Beschikbaarheid</strong>
                        <p>Standaard <span id="defaultDaysDisplay">10</span> dagen per persoon (sprintduur)</p>
                    </div>
                    <button class="sync-all-btn" onclick="syncAllAvailability()">Alles synchroniseren</button>
                </div>
                <div class="item-list" id="teamAvailabilityList"></div>
            </div>

            <div style="margin-top: 1.5rem; padding-top: 1.5rem; border-top: 1px solid var(--slate-200);">
                <div class="form-label" style="margin-bottom: 0.75rem;">Sprint Statistieken</div>
                <div class="item-list">
                    <div class="item-row">
                        <div class="item-info"><div class="item-name">Totaal Taken</div></div>
                        <div class="item-sub" id="panelStatTotal">0</div>
                    </div>
                    <div class="item-row">
                        <div class="item-info"><div class="item-name">Afgerond</div></div>
                        <div class="item-sub" id="panelStatDone">0</div>
                    </div>
                    <div class="item-row">
                        <div class="item-info"><div class="item-name">Dagen Ingepland</div></div>
                        <div class="item-sub" id="panelStatDays">0</div>
                    </div>
                    <div class="item-row">
                        <div class="item-info"><div class="item-name">Dagen Afgerond</div></div>
                        <div class="item-sub" id="panelStatDaysDone">0</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Roadmap Modal -->
    <div class="roadmap-modal" id="roadmapModal">
        <div class="dashboard-header">
            <h2 class="dashboard-title">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
                Sprint Roadmap
            </h2>
            <button class="dashboard-close" onclick="closeRoadmap()">Ã—</button>
        </div>
        <div class="roadmap-content">
            <div class="roadmap-controls">
                <button class="roadmap-nav-btn" onclick="roadmapPrevMonth()">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="15 18 9 12 15 6"/></svg>
                </button>
                <span class="roadmap-month" id="roadmapMonth">Januari 2025</span>
                <button class="roadmap-nav-btn" onclick="roadmapNextMonth()">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="9 18 15 12 9 6"/></svg>
                </button>
                <button class="btn btn-secondary" onclick="roadmapToday()" style="margin-left: 1rem;">Vandaag</button>
            </div>
            
            <div class="roadmap-timeline">
                <div class="roadmap-header" id="roadmapHeader">
                    <!-- Days will be generated here -->
                </div>
                <div class="roadmap-body" id="roadmapBody">
                    <!-- Sprint bars will be generated here -->
                </div>
                <div class="roadmap-hint">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10z"/><path d="M12 16v-4"/><path d="M12 8h.01"/></svg>
                    Sleep sprints om te verplaatsen Â· Versleep de randen om de duur aan te passen Â· Dubbelklik om te openen
                </div>
            </div>

            <div class="roadmap-sprint-list">
                <div class="roadmap-list-header">
                    <h3>Sprints</h3>
                    <button class="dashboard-add-btn" onclick="createNewSprintFromRoadmap()" title="Nieuwe sprint">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
                    </button>
                </div>
                <div class="roadmap-sprints" id="roadmapSprintList">
                    <!-- Sprint list will be generated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Dashboard Modal -->
    <div class="dashboard-modal" id="dashboardModal">
        <div class="dashboard-header">
            <h2 class="dashboard-title">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21.21 15.89A10 10 0 1 1 8 2.83"/><path d="M22 12A10 10 0 0 0 12 2v10z"/></svg>
                Statistieken Dashboard
            </h2>
            <button class="dashboard-close" onclick="closeDashboard()">Ã—</button>
        </div>
        <div class="dashboard-content">
            <div class="dashboard-grid">
                <!-- Sprint Overview -->
                <div class="dashboard-card">
                    <div class="dashboard-card-title">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>
                        Sprint Voortgang
                    </div>
                    <div class="dashboard-big-number" id="dashSprintProgress">0%</div>
                    <div class="dashboard-big-label" id="dashSprintLabel">0 van 0 taken voltooid</div>
                    <div class="dashboard-progress-bar">
                        <div class="dashboard-progress-fill" id="dashProgressFill" style="width: 0%"></div>
                    </div>
                    <div class="dashboard-progress-labels">
                        <span>Te doen</span>
                        <span>Klaar</span>
                    </div>
                </div>

                <!-- Capacity -->
                <div class="dashboard-card">
                    <div class="dashboard-card-title">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="4" width="18" height="18" rx="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
                        Capaciteit
                    </div>
                    <div class="dashboard-big-number" id="dashCapacityUsed">0</div>
                    <div class="dashboard-big-label" id="dashCapacityLabel">van 0 dagen ingepland</div>
                    <div class="dashboard-progress-bar">
                        <div class="dashboard-progress-fill" id="dashCapacityFill" style="width: 0%"></div>
                    </div>
                    <div class="dashboard-progress-labels">
                        <span id="dashCapacityRemaining">0 dagen over</span>
                        <span id="dashCapacityPercent">0%</span>
                    </div>
                </div>

                <!-- Tasks by Status -->
                <div class="dashboard-card">
                    <div class="dashboard-card-title">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 12h-4l-3 9L9 3l-3 9H2"/></svg>
                        Taken per Status
                    </div>
                    <div id="dashStatusBreakdown" class="status-breakdown"></div>
                </div>

                <!-- Tasks by Priority -->
                <div class="dashboard-card">
                    <div class="dashboard-card-title">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>
                        Prioriteiten
                    </div>
                    <div id="dashPriorityBreakdown" class="priority-breakdown"></div>
                </div>
            </div>

            <!-- Team Performance -->
            <div class="dashboard-card" style="margin-bottom: 1.5rem;">
                <div class="dashboard-card-header">
                    <div class="dashboard-card-title">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
                        Team Werkbelasting
                    </div>
                    <button class="dashboard-add-btn" onclick="addTeamMemberFromDashboard()" title="Teamlid toevoegen">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
                    </button>
                </div>
                <div class="team-stats-list" id="dashTeamStats"></div>
            </div>

            <!-- Epic Progress -->
            <div class="dashboard-card">
                <div class="dashboard-card-header">
                    <div class="dashboard-card-title">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="12 2 2 7 12 12 22 7 12 2"/><polyline points="2 17 12 22 22 17"/><polyline points="2 12 12 17 22 12"/></svg>
                        Epic Voortgang
                    </div>
                    <button class="dashboard-add-btn" onclick="addEpicFromDashboard()" title="Epic toevoegen">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
                    </button>
                </div>
                <div class="team-stats-list" id="dashEpicStats"></div>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <script>
        // ============================================
        // DATA STRUCTURES & STATE
        // ============================================

        const STORAGE_KEY = 'sprintflow_kanban_v5';

        const COLUMNS = [
            { id: 'backlog', name: 'Backlog', color: '#64748b' },
            { id: 'todo', name: 'Te Doen', color: '#3b82f6' },
            { id: 'bezig', name: 'Bezig', color: '#f97316' },
            { id: 'review', name: 'Review', color: '#a855f7' },
            { id: 'klaar', name: 'Klaar', color: '#22c55e' }
        ];

        const AVATAR_COLORS = [
            '#10b981', '#3b82f6', '#a855f7', '#f97316', '#ef4444',
            '#ec4899', '#14b8a6', '#8b5cf6', '#06b6d4', '#84cc16'
        ];

        let state = {
            // Multi-project structure
            projects: [],
            activeProjectId: null,
            activeSprintId: null,
            
            // UI state
            filters: { search: '', epic: null, owner: null, status: null },
            currentEditSubtasks: [],
            expandedEpics: {},
            expandedTeam: {}
        };

        // Helper to get active project
        function getActiveProject() {
            return state.projects.find(p => p.id === state.activeProjectId) || state.projects[0];
        }

        // Helper to get active sprint
        function getActiveSprint() {
            const project = getActiveProject();
            if (!project) return null;
            return project.sprints.find(s => s.id === state.activeSprintId) || project.sprints[0];
        }

        // Helper to get cards for active sprint
        function getActiveCards() {
            const project = getActiveProject();
            const sprint = getActiveSprint();
            if (!project || !sprint) return [];
            return project.cards.filter(c => c.sprintId === sprint.id);
        }

        // Helper to get all project cards (for backlog)
        function getAllProjectCards() {
            const project = getActiveProject();
            return project ? project.cards : [];
        }

        // Create default project
        function createDefaultProject() {
            return {
                id: generateId(),
                name: 'Mijn Project',
                sprints: [{
                    id: generateId(),
                    name: 'Sprint 1',
                    startDate: '',
                    endDate: '',
                    days: 10,
                    goal: '',
                    status: 'active'
                }],
                cards: [],
                team: [],
                epics: [],
                teamAvailability: {}
            };
        }

        // Compatibility getters (return references to active project data)
        function getCards() {
            const project = getActiveProject();
            return project ? project.cards : [];
        }
        function getTeam() {
            const project = getActiveProject();
            return project ? project.team : [];
        }
        function getEpics() {
            const project = getActiveProject();
            return project ? project.epics : [];
        }
        function getTeamAvailability() {
            const project = getActiveProject();
            return project ? project.teamAvailability : {};
        }

        let saveTimeout = null;

        // ============================================
        // STORAGE - Auto-save to localStorage
        // ============================================

        function saveToStorage() {
            // Show saving indicator
            const indicator = document.getElementById('saveIndicator');
            indicator.classList.add('saving');
            indicator.querySelector('span').textContent = 'Opslaan...';
            indicator.querySelector('svg').innerHTML = '<circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/>';

            // Debounce saving
            clearTimeout(saveTimeout);
            saveTimeout = setTimeout(() => {
                try {
                    const dataToSave = {
                        projects: state.projects,
                        activeProjectId: state.activeProjectId,
                        activeSprintId: state.activeSprintId
                    };
                    localStorage.setItem(STORAGE_KEY, JSON.stringify(dataToSave));
                    
                    // Show saved indicator
                    indicator.classList.remove('saving');
                    indicator.querySelector('span').textContent = 'Opgeslagen';
                    indicator.querySelector('svg').innerHTML = '<path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/>';
                } catch (e) {
                    console.error('Fout bij opslaan:', e);
                    indicator.classList.remove('saving');
                    indicator.querySelector('span').textContent = 'Fout bij opslaan';
                }
            }, 300);
        }

        function loadFromStorage() {
            try {
                const saved = localStorage.getItem(STORAGE_KEY);
                if (saved) {
                    const data = JSON.parse(saved);
                    if (data.projects && data.projects.length > 0) {
                        // New multi-project format
                        state.projects = data.projects;
                        state.activeProjectId = data.activeProjectId || data.projects[0].id;
                        state.activeSprintId = data.activeSprintId;
                        // Ensure activeSprintId is valid
                        const project = getActiveProject();
                        if (project && project.sprints.length > 0) {
                            if (!state.activeSprintId || !project.sprints.find(s => s.id === state.activeSprintId)) {
                                state.activeSprintId = project.sprints[0].id;
                            }
                        }
                    } else if (data.cards || data.team || data.epics) {
                        // Migrate old single-project format
                        const defaultProject = createDefaultProject();
                        defaultProject.cards = (data.cards || []).map(c => ({...c, sprintId: defaultProject.sprints[0].id}));
                        defaultProject.team = data.team || [];
                        defaultProject.epics = data.epics || [];
                        defaultProject.teamAvailability = data.teamAvailability || {};
                        if (data.sprint) {
                            defaultProject.sprints[0] = {...defaultProject.sprints[0], ...data.sprint};
                        }
                        state.projects = [defaultProject];
                        state.activeProjectId = defaultProject.id;
                        state.activeSprintId = defaultProject.sprints[0].id;
                        // Save migrated data
                        saveToStorage();
                    }
                }
                
                // Ensure at least one project exists
                if (state.projects.length === 0) {
                    const defaultProject = createDefaultProject();
                    state.projects = [defaultProject];
                    state.activeProjectId = defaultProject.id;
                    state.activeSprintId = defaultProject.sprints[0].id;
                }
            } catch (e) {
                console.error('Fout bij laden:', e);
                // Create default project on error
                const defaultProject = createDefaultProject();
                state.projects = [defaultProject];
                state.activeProjectId = defaultProject.id;
                state.activeSprintId = defaultProject.sprints[0].id;
            }
        }

        function clearAllData() {
            if (confirm('Weet je zeker dat je ALLE data wilt wissen? Dit kan niet ongedaan worden gemaakt.')) {
                localStorage.removeItem(STORAGE_KEY);
                location.reload();
            }
        }

        // ============================================
        // PROJECT & SPRINT MANAGEMENT
        // ============================================

        function createNewProject() {
            const name = prompt('Project naam:', 'Nieuw Project');
            if (name && name.trim()) {
                const newProject = createDefaultProject();
                newProject.name = name.trim();
                state.projects.push(newProject);
                state.activeProjectId = newProject.id;
                state.activeSprintId = newProject.sprints[0].id;
                saveToStorage();
                refreshUI();
                showToast('Project aangemaakt');
            }
            closeDropdown('projectDropdown');
        }

        function switchProject(projectId) {
            state.activeProjectId = projectId;
            const project = getActiveProject();
            if (project && project.sprints.length > 0) {
                state.activeSprintId = project.sprints.find(s => s.status === 'active')?.id || project.sprints[0].id;
            }
            state.filters = { search: '', epic: null, owner: null, status: null };
            document.getElementById('searchInput').value = '';
            saveToStorage();
            refreshUI();
            closeDropdown('projectDropdown');
        }

        function editProjectName() {
            const project = getActiveProject();
            if (!project) return;
            
            const newName = prompt('Project naam:', project.name);
            if (newName && newName.trim() && newName.trim() !== project.name) {
                project.name = newName.trim();
                saveToStorage();
                refreshUI();
                showToast('Project hernoemd');
            }
        }

        function deleteCurrentProject() {
            closeDropdown('projectDropdown');
            const project = getActiveProject();
            if (!project) return;
            
            if (state.projects.length <= 1) {
                showToast('Je moet minstens Ã©Ã©n project hebben', 'error');
                return;
            }
            if (confirm(`Weet je zeker dat je "${project.name}" en alle bijbehorende data wilt verwijderen?`)) {
                state.projects = state.projects.filter(p => p.id !== project.id);
                state.activeProjectId = state.projects[0].id;
                state.activeSprintId = state.projects[0].sprints[0]?.id;
                saveToStorage();
                refreshUI();
                showToast('Project verwijderd');
            }
        }

        function deleteProject(projectId) {
            if (state.projects.length <= 1) {
                showToast('Je moet minstens Ã©Ã©n project hebben', 'error');
                return;
            }
            if (confirm('Weet je zeker dat je dit project en alle bijbehorende data wilt verwijderen?')) {
                state.projects = state.projects.filter(p => p.id !== projectId);
                if (state.activeProjectId === projectId) {
                    state.activeProjectId = state.projects[0].id;
                    state.activeSprintId = state.projects[0].sprints[0]?.id;
                }
                saveToStorage();
                refreshUI();
                showToast('Project verwijderd');
            }
        }

        function createNewSprint() {
            const project = getActiveProject();
            if (!project) return;
            
            const sprintNum = project.sprints.length + 1;
            const name = prompt('Sprint naam:', `Sprint ${sprintNum}`);
            if (name && name.trim()) {
                const newSprint = {
                    id: generateId(),
                    name: name.trim(),
                    startDate: '',
                    endDate: '',
                    days: 10,
                    goal: '',
                    status: 'planned'
                };
                project.sprints.push(newSprint);
                state.activeSprintId = newSprint.id;
                saveToStorage();
                refreshUI();
                showToast('Sprint aangemaakt');
            }
        }

        function switchSprint(sprintId) {
            state.activeSprintId = sprintId;
            state.filters = { search: '', epic: null, owner: null, status: null };
            document.getElementById('searchInput').value = '';
            saveToStorage();
            refreshUI();
        }

        function editSprintInline() {
            const sprint = getActiveSprint();
            if (!sprint) return;
            
            const newName = prompt('Sprint naam:', sprint.name);
            if (newName && newName.trim() !== '') {
                sprint.name = newName.trim();
                saveToStorage();
                refreshUI();
                showToast('Sprint hernoemd');
            }
        }

        function refreshUI() {
            renderProjectList();
            renderSprintTabs();
            renderBoard();
            renderFilterChips();
            updateStats();
            updateSprintInfo();
        }

        function renderProjectList() {
            const list = document.getElementById('projectList');
            const activeProject = getActiveProject();
            document.getElementById('activeProjectName').textContent = activeProject?.name || 'Selecteer project';
            
            list.innerHTML = state.projects.map(project => {
                const taskCount = project.cards.length;
                const teamCount = project.team.length;
                return `
                    <button class="project-item ${project.id === state.activeProjectId ? 'active' : ''}" onclick="switchProject('${project.id}')">
                        <div class="project-icon">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="3"/><line x1="8" y1="7" x2="8" y2="17"/><line x1="12" y1="7" x2="12" y2="14"/><line x1="16" y1="7" x2="16" y2="11"/></svg>
                        </div>
                        <div class="project-item-info">
                            <div class="project-item-name">${project.name}</div>
                            <div class="project-item-meta">${taskCount} taken Â· ${teamCount} teamleden</div>
                        </div>
                    </button>
                `;
            }).join('');
        }

        function renderSprintTabs() {
            const project = getActiveProject();
            if (!project) return;
            
            const tabs = document.getElementById('sprintTabs');
            tabs.innerHTML = project.sprints.map(sprint => {
                const taskCount = project.cards.filter(c => c.sprintId === sprint.id).length;
                const isActive = sprint.id === state.activeSprintId;
                return `
                    <button class="sprint-tab ${isActive ? 'active' : ''}" onclick="switchSprint('${sprint.id}')" ondblclick="editSprintName('${sprint.id}')">
                        <span class="sprint-status-dot ${sprint.status || 'active'}"></span>
                        <span>${sprint.name}</span>
                        <span class="sprint-task-count">${taskCount}</span>
                    </button>
                `;
            }).join('');
        }

        function editSprintName(sprintId) {
            const project = getActiveProject();
            const sprint = project?.sprints.find(s => s.id === sprintId);
            if (!sprint) return;
            
            const newName = prompt('Sprint naam:', sprint.name);
            if (newName && newName.trim()) {
                sprint.name = newName.trim();
                saveToStorage();
                renderSprintTabs();
                updateSprintInfo();
                showToast('Sprint hernoemd');
            }
        }

        function updateSprintInfo() {
            const sprint = getActiveSprint();
            const project = getActiveProject();
            
            document.getElementById('currentSprintName').textContent = sprint?.name || 'Sprint';
            
            if (sprint?.startDate && sprint?.endDate) {
                const start = new Date(sprint.startDate).toLocaleDateString('nl-NL', { day: 'numeric', month: 'short' });
                const end = new Date(sprint.endDate).toLocaleDateString('nl-NL', { day: 'numeric', month: 'short' });
                document.getElementById('sprintDates').textContent = `${start} - ${end}`;
            } else {
                document.getElementById('sprintDates').textContent = 'Geen datums ingesteld';
            }
        }

        // ============================================
        // DASHBOARD
        // ============================================

        function openDashboard() {
            updateDashboard();
            document.getElementById('dashboardModal').classList.add('active');
        }

        function closeDashboard() {
            document.getElementById('dashboardModal').classList.remove('active');
        }

        function updateDashboard() {
            const project = getActiveProject();
            const sprint = getActiveSprint();
            if (!project || !sprint) return;

            const cards = project.cards.filter(c => c.sprintId === sprint.id);
            const total = cards.length;
            const done = cards.filter(c => c.status === 'klaar').length;
            const progressPercent = total > 0 ? Math.round((done / total) * 100) : 0;

            // Sprint progress
            document.getElementById('dashSprintProgress').textContent = progressPercent + '%';
            document.getElementById('dashSprintLabel').textContent = `${done} van ${total} taken voltooid`;
            document.getElementById('dashProgressFill').style.width = progressPercent + '%';

            // Capacity
            const totalCapacity = Object.values(project.teamAvailability).reduce((sum, v) => sum + (parseFloat(v) || 0), 0);
            const usedCapacity = cards.reduce((sum, c) => sum + (parseFloat(c.estimate) || 0), 0);
            const capacityPercent = totalCapacity > 0 ? Math.round((usedCapacity / totalCapacity) * 100) : 0;

            document.getElementById('dashCapacityUsed').textContent = usedCapacity;
            document.getElementById('dashCapacityLabel').textContent = `van ${totalCapacity} dagen ingepland`;
            document.getElementById('dashCapacityFill').style.width = Math.min(capacityPercent, 100) + '%';
            document.getElementById('dashCapacityFill').style.background = capacityPercent > 100 
                ? 'linear-gradient(90deg, var(--red-500) 0%, #f87171 100%)' 
                : 'linear-gradient(90deg, var(--accent) 0%, #34d399 100%)';
            document.getElementById('dashCapacityRemaining').textContent = `${Math.max(0, totalCapacity - usedCapacity)} dagen over`;
            document.getElementById('dashCapacityPercent').textContent = capacityPercent + '%';

            // Status breakdown
            const statusBreakdown = document.getElementById('dashStatusBreakdown');
            statusBreakdown.innerHTML = COLUMNS.map(col => {
                const count = cards.filter(c => c.status === col.id).length;
                const percent = total > 0 ? Math.round((count / total) * 100) : 0;
                return `
                    <div class="status-row" onclick="filterFromDashboard('status', '${col.id}')">
                        <span class="status-dot" style="background: ${col.color}"></span>
                        <span class="status-name">${col.name}</span>
                        <div class="status-bar"><div class="status-bar-fill" style="width: ${percent}%; background: ${col.color}"></div></div>
                        <span class="status-count">${count}</span>
                    </div>
                `;
            }).join('');

            // Priority breakdown
            const priorities = [
                { id: 'high', name: 'Hoog', color: '#ef4444' },
                { id: 'medium', name: 'Middel', color: '#f97316' },
                { id: 'low', name: 'Laag', color: '#22c55e' },
                { id: null, name: 'Geen', color: '#94a3b8' }
            ];
            const priorityBreakdown = document.getElementById('dashPriorityBreakdown');
            priorityBreakdown.innerHTML = priorities.map(p => {
                const count = cards.filter(c => c.priority === p.id).length;
                const percent = total > 0 ? Math.round((count / total) * 100) : 0;
                return `
                    <div class="status-row">
                        <span class="status-dot" style="background: ${p.color}"></span>
                        <span class="status-name">${p.name}</span>
                        <div class="status-bar"><div class="status-bar-fill" style="width: ${percent}%; background: ${p.color}"></div></div>
                        <span class="status-count">${count}</span>
                    </div>
                `;
            }).join('');

            // Team stats
            const teamStats = document.getElementById('dashTeamStats');
            if (project.team.length > 0) {
                teamStats.innerHTML = project.team.map(member => {
                    const memberCards = cards.filter(c => c.ownerId === member.id);
                    const memberDone = memberCards.filter(c => c.status === 'klaar').length;
                    const memberEstimate = memberCards.reduce((sum, c) => sum + (parseFloat(c.estimate) || 0), 0);
                    const memberAvailability = project.teamAvailability[member.id] || sprint.days || 10;
                    const workloadPercent = memberAvailability > 0 ? Math.round((memberEstimate / memberAvailability) * 100) : 0;
                    const barColor = workloadPercent > 100 ? 'var(--red-500)' : workloadPercent > 80 ? 'var(--orange-500)' : 'var(--accent)';
                    
                    return `
                        <div class="team-stat-item" onclick="filterFromDashboard('owner', '${member.id}')">
                            <div class="team-stat-avatar" style="background: ${member.color}">${getInitials(member.name)}</div>
                            <div class="team-stat-info">
                                <div class="team-stat-name">${member.name}</div>
                                <div class="team-stat-meta">${memberDone}/${memberCards.length} taken Â· ${memberEstimate}/${memberAvailability} dagen</div>
                            </div>
                            <div class="team-stat-bar">
                                <div class="team-stat-bar-fill" style="width: ${Math.min(workloadPercent, 100)}%; background: ${barColor}"></div>
                            </div>
                            <div class="team-stat-value">${workloadPercent}%</div>
                        </div>
                    `;
                }).join('');
            } else {
                teamStats.innerHTML = '<div class="empty-state"><p>Voeg teamleden toe om werkbelasting te zien</p></div>';
            }

            // Epic stats
            const epicStats = document.getElementById('dashEpicStats');
            if (project.epics.length > 0) {
                epicStats.innerHTML = project.epics.map(epic => {
                    const epicCards = cards.filter(c => c.epicId === epic.id);
                    const epicDone = epicCards.filter(c => c.status === 'klaar').length;
                    const epicPercent = epicCards.length > 0 ? Math.round((epicDone / epicCards.length) * 100) : 0;
                    
                    return `
                        <div class="team-stat-item" onclick="filterFromDashboard('epic', '${epic.id}')">
                            <div class="team-stat-avatar" style="background: ${epic.color}; border-radius: var(--radius-sm);">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width: 18px; height: 18px;"><polygon points="12 2 2 7 12 12 22 7 12 2"/></svg>
                            </div>
                            <div class="team-stat-info">
                                <div class="team-stat-name">${epic.name}</div>
                                <div class="team-stat-meta">${epicDone}/${epicCards.length} taken voltooid</div>
                            </div>
                            <div class="team-stat-bar">
                                <div class="team-stat-bar-fill" style="width: ${epicPercent}%; background: ${epic.color}"></div>
                            </div>
                            <div class="team-stat-value">${epicPercent}%</div>
                        </div>
                    `;
                }).join('');
            } else {
                epicStats.innerHTML = '<div class="empty-state"><p>Voeg epics toe om voortgang te zien</p></div>';
            }
        }

        function filterFromDashboard(type, value) {
            closeDashboard();
            state.filters[type] = value;
            renderBoard();
            renderFilterChips();
        }

        function addTeamMemberFromDashboard() {
            const project = getActiveProject();
            const sprint = getActiveSprint();
            if (!project) return;
            
            const name = prompt('Naam van nieuw teamlid:');
            if (name && name.trim()) {
                const color = AVATAR_COLORS[Math.floor(Math.random() * AVATAR_COLORS.length)];
                const newMember = { id: generateId(), name: name.trim(), color };
                project.team.push(newMember);
                project.teamAvailability[newMember.id] = parseFloat(sprint?.days) || 10;
                saveToStorage();
                updateDashboard();
                renderFilterChips();
                showToast('Teamlid toegevoegd');
            }
        }

        function addEpicFromDashboard() {
            const project = getActiveProject();
            if (!project) return;
            
            const name = prompt('Naam van nieuwe epic:');
            if (name && name.trim()) {
                const color = AVATAR_COLORS[Math.floor(Math.random() * AVATAR_COLORS.length)];
                const newEpic = { id: generateId(), name: name.trim(), color };
                project.epics.push(newEpic);
                saveToStorage();
                updateDashboard();
                renderFilterChips();
                showToast('Epic toegevoegd');
            }
        }

        // ============================================
        // ROADMAP
        // ============================================

        let roadmapDate = new Date();

        function openRoadmap() {
            roadmapDate = new Date();
            renderRoadmap();
            document.getElementById('roadmapModal').classList.add('active');
        }

        function closeRoadmap() {
            document.getElementById('roadmapModal').classList.remove('active');
        }

        function roadmapPrevMonth() {
            roadmapDate.setMonth(roadmapDate.getMonth() - 1);
            renderRoadmap();
        }

        function roadmapNextMonth() {
            roadmapDate.setMonth(roadmapDate.getMonth() + 1);
            renderRoadmap();
        }

        function roadmapToday() {
            roadmapDate = new Date();
            renderRoadmap();
        }

        function renderRoadmap() {
            const project = getActiveProject();
            if (!project) return;

            const year = roadmapDate.getFullYear();
            const month = roadmapDate.getMonth();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            const today = new Date();

            // Update month label
            const monthNames = ['Januari', 'Februari', 'Maart', 'April', 'Mei', 'Juni', 
                              'Juli', 'Augustus', 'September', 'Oktober', 'November', 'December'];
            document.getElementById('roadmapMonth').textContent = `${monthNames[month]} ${year}`;

            // Set CSS variable for days count
            document.querySelector('.roadmap-header').style.setProperty('--days-count', daysInMonth);

            // Render header (days)
            const header = document.getElementById('roadmapHeader');
            const dayNames = ['Zo', 'Ma', 'Di', 'Wo', 'Do', 'Vr', 'Za'];
            let headerHTML = '';
            for (let d = 1; d <= daysInMonth; d++) {
                const date = new Date(year, month, d);
                const isToday = date.toDateString() === today.toDateString();
                const isWeekend = date.getDay() === 0 || date.getDay() === 6;
                headerHTML += `
                    <div class="roadmap-day ${isToday ? 'today' : ''} ${isWeekend ? 'weekend' : ''}">
                        <div>${dayNames[date.getDay()]}</div>
                        <div class="day-num">${d}</div>
                    </div>
                `;
            }
            header.innerHTML = headerHTML;

            // Render sprint bars
            const body = document.getElementById('roadmapBody');
            body.style.setProperty('--days-count', daysInMonth);
            
            let bodyHTML = '';
            const monthStart = new Date(year, month, 1);
            const monthEnd = new Date(year, month, daysInMonth, 23, 59, 59);

            // Store for drag calculations
            window.roadmapData = { year, month, daysInMonth };

            // Add today line
            if (today.getMonth() === month && today.getFullYear() === year) {
                const todayPos = ((today.getDate() - 0.5) / daysInMonth) * 100;
                bodyHTML += `<div class="roadmap-today-line" style="left: ${todayPos}%"></div>`;
            }

            project.sprints.forEach((sprint, index) => {
                const taskCount = project.cards.filter(c => c.sprintId === sprint.id).length;
                const isActive = sprint.id === state.activeSprintId;
                
                if (sprint.startDate && sprint.endDate) {
                    const start = new Date(sprint.startDate);
                    const end = new Date(sprint.endDate);
                    
                    // Check if sprint overlaps with current month
                    if (end >= monthStart && start <= monthEnd) {
                        const startDay = start < monthStart ? 1 : start.getDate();
                        const endDay = end > monthEnd ? daysInMonth : end.getDate();
                        
                        const leftPercent = ((startDay - 1) / daysInMonth) * 100;
                        const widthPercent = ((endDay - startDay + 1) / daysInMonth) * 100;
                        
                        bodyHTML += `
                            <div class="roadmap-sprint-row" data-sprint-id="${sprint.id}">
                                <div class="roadmap-sprint-bar ${sprint.status || 'active'} ${isActive ? 'active' : ''}" 
                                     style="left: ${leftPercent}%; width: ${widthPercent}%;"
                                     data-sprint-id="${sprint.id}"
                                     data-start="${sprint.startDate}"
                                     data-end="${sprint.endDate}"
                                     onmousedown="startSprintDrag(event, '${sprint.id}')"
                                     ondblclick="goToSprintFromRoadmap('${sprint.id}')">
                                    <div class="roadmap-resize-handle left" onmousedown="startSprintResize(event, '${sprint.id}', 'left')"></div>
                                    <span class="roadmap-sprint-name">${sprint.name}</span>
                                    <span class="roadmap-sprint-tasks">${taskCount}</span>
                                    <div class="roadmap-resize-handle right" onmousedown="startSprintResize(event, '${sprint.id}', 'right')"></div>
                                    <div class="roadmap-date-tooltip">${toDisplayDate(sprint.startDate)} â€” ${toDisplayDate(sprint.endDate)}</div>
                                </div>
                            </div>
                        `;
                    }
                } else {
                    // Sprint without dates - show as dashed bar
                    bodyHTML += `
                        <div class="roadmap-sprint-row">
                            <div class="roadmap-sprint-bar no-dates" 
                                 style="left: 5%; width: 30%;"
                                 onclick="editSprintDatesFromRoadmap('${sprint.id}')"
                                 title="${sprint.name}: Klik om datums in te stellen">
                                <span class="roadmap-sprint-name">${sprint.name}</span>
                                <span class="roadmap-sprint-tasks">${taskCount}</span>
                            </div>
                        </div>
                    `;
                }
            });

            if (project.sprints.length === 0) {
                bodyHTML = '<div class="empty-state" style="padding: 2rem;"><p>Nog geen sprints. Maak je eerste sprint aan!</p></div>';
            }

            body.innerHTML = bodyHTML;

            // Render sprint list
            renderRoadmapSprintList();
        }

        function renderRoadmapSprintList() {
            const project = getActiveProject();
            if (!project) return;

            const list = document.getElementById('roadmapSprintList');
            
            if (project.sprints.length === 0) {
                list.innerHTML = '<div class="empty-state"><p>Nog geen sprints</p></div>';
                return;
            }

            list.innerHTML = project.sprints.map(sprint => {
                const taskCount = project.cards.filter(c => c.sprintId === sprint.id).length;
                const doneCount = project.cards.filter(c => c.sprintId === sprint.id && c.status === 'klaar').length;
                const isActive = sprint.id === state.activeSprintId;
                const hasDate = sprint.startDate && sprint.endDate;
                
                return `
                    <div class="roadmap-sprint-item ${isActive ? 'active' : ''}" onclick="goToSprintFromRoadmap('${sprint.id}')">
                        <div class="roadmap-sprint-dot ${sprint.status || 'active'}"></div>
                        <div class="roadmap-sprint-info">
                            <div class="roadmap-sprint-title">${sprint.name}</div>
                            <div class="roadmap-sprint-dates">
                                ${hasDate ? `${toDisplayDate(sprint.startDate)} - ${toDisplayDate(sprint.endDate)}` : 'Geen datums ingesteld'}
                            </div>
                        </div>
                        <div class="roadmap-sprint-meta">
                            <div class="roadmap-sprint-count">${doneCount}/${taskCount}</div>
                            <div class="roadmap-sprint-status">${taskCount === 0 ? 'Leeg' : doneCount === taskCount ? 'Klaar' : 'Actief'}</div>
                        </div>
                        <div class="roadmap-sprint-actions">
                            <button class="card-action-btn" onclick="event.stopPropagation(); editSprintFromRoadmap('${sprint.id}')" title="Bewerken">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>
                            </button>
                            <button class="card-action-btn delete" onclick="event.stopPropagation(); deleteSprintFromRoadmap('${sprint.id}')" title="Verwijderen">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function goToSprintFromRoadmap(sprintId) {
            state.activeSprintId = sprintId;
            saveToStorage();
            closeRoadmap();
            refreshUI();
            showToast('Sprint geopend');
        }

        function editSprintFromRoadmap(sprintId) {
            const project = getActiveProject();
            const sprint = project?.sprints.find(s => s.id === sprintId);
            if (!sprint) return;

            const newName = prompt('Sprint naam:', sprint.name);
            if (newName && newName.trim()) {
                sprint.name = newName.trim();
                saveToStorage();
                renderRoadmap();
                renderSprintTabs();
                updateSprintInfo();
                showToast('Sprint hernoemd');
            }
        }

        function editSprintDatesFromRoadmap(sprintId) {
            const project = getActiveProject();
            const sprint = project?.sprints.find(s => s.id === sprintId);
            if (!sprint) return;

            // Date input in dd/mm/jjjj format
            const currentStart = sprint.startDate ? toDisplayDate(sprint.startDate) : getTodayDisplay();
            const startInput = prompt('Startdatum (dd/mm/jjjj):', currentStart);
            if (startInput === null) return;
            
            const currentEnd = sprint.endDate ? toDisplayDate(sprint.endDate) : '';
            const endInput = prompt('Einddatum (dd/mm/jjjj):', currentEnd);
            if (endInput === null) return;

            // Convert to ISO format for storage
            const startDate = toIsoDate(startInput);
            const endDate = toIsoDate(endInput);

            if (startInput && !startDate) {
                showToast('Ongeldige startdatum. Gebruik dd/mm/jjjj', 'error');
                return;
            }
            if (endInput && !endDate) {
                showToast('Ongeldige einddatum. Gebruik dd/mm/jjjj', 'error');
                return;
            }

            if (startDate) sprint.startDate = startDate;
            if (endDate) sprint.endDate = endDate;
            
            saveToStorage();
            renderRoadmap();
            updateSprintInfo();
            showToast('Sprint datums bijgewerkt');
        }

        function deleteSprintFromRoadmap(sprintId) {
            const project = getActiveProject();
            if (!project) return;

            if (project.sprints.length <= 1) {
                showToast('Je moet minstens Ã©Ã©n sprint hebben', 'error');
                return;
            }

            const sprint = project.sprints.find(s => s.id === sprintId);
            const taskCount = project.cards.filter(c => c.sprintId === sprintId).length;

            if (confirm(`Weet je zeker dat je "${sprint.name}" wilt verwijderen?${taskCount > 0 ? `\n\nLet op: ${taskCount} taken worden verplaatst naar de eerste sprint.` : ''}`)) {
                // Move tasks to first sprint
                const firstSprint = project.sprints.find(s => s.id !== sprintId);
                project.cards.forEach(card => {
                    if (card.sprintId === sprintId) {
                        card.sprintId = firstSprint.id;
                    }
                });

                project.sprints = project.sprints.filter(s => s.id !== sprintId);
                
                if (state.activeSprintId === sprintId) {
                    state.activeSprintId = firstSprint.id;
                }

                saveToStorage();
                renderRoadmap();
                renderSprintTabs();
                showToast('Sprint verwijderd');
            }
        }

        function createNewSprintFromRoadmap() {
            const project = getActiveProject();
            if (!project) return;

            const sprintNum = project.sprints.length + 1;
            const name = prompt('Sprint naam:', `Sprint ${sprintNum}`);
            if (name && name.trim()) {
                // Calculate suggested dates based on last sprint
                let startDate = '';
                let endDate = '';
                const lastSprint = project.sprints[project.sprints.length - 1];
                if (lastSprint?.endDate) {
                    const lastEnd = new Date(lastSprint.endDate);
                    lastEnd.setDate(lastEnd.getDate() + 1);
                    startDate = lastEnd.toISOString().split('T')[0];
                    lastEnd.setDate(lastEnd.getDate() + 13); // 2 weeks
                    endDate = lastEnd.toISOString().split('T')[0];
                }

                const newSprint = {
                    id: generateId(),
                    name: name.trim(),
                    startDate,
                    endDate,
                    days: 10,
                    goal: '',
                    status: 'planned'
                };
                project.sprints.push(newSprint);
                saveToStorage();
                renderRoadmap();
                renderSprintTabs();
                showToast('Sprint aangemaakt');
            }
        }

        // ============================================
        // ROADMAP DRAG & RESIZE
        // ============================================

        let dragState = null;

        function startSprintDrag(e, sprintId) {
            // Don't start drag if clicking on resize handle
            if (e.target.classList.contains('roadmap-resize-handle')) return;
            
            e.preventDefault();
            const bar = e.currentTarget;
            const body = document.getElementById('roadmapBody');
            const bodyRect = body.getBoundingClientRect();
            
            dragState = {
                type: 'drag',
                sprintId,
                bar,
                bodyRect,
                startX: e.clientX,
                startY: e.clientY,
                initialLeft: parseFloat(bar.style.left),
                initialWidth: parseFloat(bar.style.width),
                hasMoved: false
            };
            
            bar.classList.add('dragging');
            document.addEventListener('mousemove', handleSprintDrag);
            document.addEventListener('mouseup', endSprintDrag);
        }

        function startSprintResize(e, sprintId, side) {
            e.preventDefault();
            e.stopPropagation();
            
            const bar = e.target.parentElement;
            const body = document.getElementById('roadmapBody');
            const bodyRect = body.getBoundingClientRect();
            
            dragState = {
                type: 'resize',
                side,
                sprintId,
                bar,
                bodyRect,
                startX: e.clientX,
                initialLeft: parseFloat(bar.style.left),
                initialWidth: parseFloat(bar.style.width),
                hasMoved: false
            };
            
            bar.classList.add('dragging', 'resizing');
            document.addEventListener('mousemove', handleSprintDrag);
            document.addEventListener('mouseup', endSprintDrag);
        }

        function handleSprintDrag(e) {
            if (!dragState) return;
            
            const { type, side, bar, bodyRect, startX, initialLeft, initialWidth, sprintId } = dragState;
            const { daysInMonth, year, month } = window.roadmapData;
            
            const deltaX = e.clientX - startX;
            
            // Mark as moved if significant movement
            if (Math.abs(deltaX) > 3) {
                dragState.hasMoved = true;
            }
            
            const deltaPercent = (deltaX / bodyRect.width) * 100;
            
            let newLeft = initialLeft;
            let newWidth = initialWidth;
            
            if (type === 'drag') {
                // Move the entire bar
                newLeft = Math.max(0, Math.min(100 - initialWidth, initialLeft + deltaPercent));
            } else if (type === 'resize') {
                if (side === 'left') {
                    // Resize from left side
                    const maxDelta = initialWidth - (100 / daysInMonth); // Min 1 day
                    const clampedDelta = Math.max(-initialLeft, Math.min(maxDelta, deltaPercent));
                    newLeft = initialLeft + clampedDelta;
                    newWidth = initialWidth - clampedDelta;
                } else {
                    // Resize from right side
                    const minWidth = 100 / daysInMonth; // Min 1 day
                    newWidth = Math.max(minWidth, Math.min(100 - initialLeft, initialWidth + deltaPercent));
                }
            }
            
            bar.style.left = `${newLeft}%`;
            bar.style.width = `${newWidth}%`;
            
            // Calculate dates from position
            const startDay = Math.max(1, Math.min(daysInMonth, Math.round((newLeft / 100) * daysInMonth) + 1));
            const endDay = Math.max(1, Math.min(daysInMonth, Math.round(((newLeft + newWidth) / 100) * daysInMonth)));
            
            const newStartDate = new Date(year, month, startDay);
            const newEndDate = new Date(year, month, endDay);
            
            // Update tooltip with dates (tooltip is inside the bar now)
            const tooltip = bar.querySelector('.roadmap-date-tooltip');
            if (tooltip) {
                tooltip.textContent = `${toDisplayDate(formatIsoDate(newStartDate))} â€” ${toDisplayDate(formatIsoDate(newEndDate))}`;
            }
            
            // Store calculated dates for use when drag ends
            dragState.newStartDate = formatIsoDate(newStartDate);
            dragState.newEndDate = formatIsoDate(newEndDate);
        }

        function endSprintDrag(e) {
            if (!dragState) return;
            
            const { sprintId, bar, newStartDate, newEndDate, hasMoved } = dragState;
            
            bar.classList.remove('dragging', 'resizing');
            
            // Update sprint dates if moved and changed
            if (hasMoved && newStartDate && newEndDate) {
                const project = getActiveProject();
                const sprint = project?.sprints.find(s => s.id === sprintId);
                if (sprint && (sprint.startDate !== newStartDate || sprint.endDate !== newEndDate)) {
                    sprint.startDate = newStartDate;
                    sprint.endDate = newEndDate;
                    saveToStorage();
                    renderRoadmap();
                    renderRoadmapSprintList();
                    updateSprintInfo();
                    showToast('Sprint datums aangepast');
                }
            }
            
            document.removeEventListener('mousemove', handleSprintDrag);
            document.removeEventListener('mouseup', endSprintDrag);
            dragState = null;
        }

        function formatIsoDate(date) {
            const y = date.getFullYear();
            const m = String(date.getMonth() + 1).padStart(2, '0');
            const d = String(date.getDate()).padStart(2, '0');
            return `${y}-${m}-${d}`;
        }

        // ============================================
        // UTILITY FUNCTIONS
        // ============================================

        function generateId() {
            return 'id_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        }

        function getInitials(name) {
            return name.split(' ').map(n => n[0]).join('').toUpperCase().slice(0, 2);
        }

        // Date format helpers (dd/mm/jjjj <-> YYYY-MM-DD)
        function toDisplayDate(isoDate) {
            if (!isoDate) return '';
            const [year, month, day] = isoDate.split('-');
            return `${day}/${month}/${year}`;
        }

        function toIsoDate(displayDate) {
            if (!displayDate) return '';
            const parts = displayDate.split('/');
            if (parts.length !== 3) return '';
            const day = parseInt(parts[0], 10);
            const month = parseInt(parts[1], 10);
            const year = parseInt(parts[2], 10);
            // Validate
            if (isNaN(day) || isNaN(month) || isNaN(year)) return '';
            if (day < 1 || day > 31 || month < 1 || month > 12 || year < 2000 || year > 2100) return '';
            return `${year}-${String(month).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
        }

        function getTodayDisplay() {
            const today = new Date();
            const d = String(today.getDate()).padStart(2, '0');
            const m = String(today.getMonth() + 1).padStart(2, '0');
            const y = today.getFullYear();
            return `${d}/${m}/${y}`;
        }

        function formatDate(dateStr) {
            if (!dateStr) return '';
            return new Date(dateStr).toLocaleDateString('nl-NL', { day: 'numeric', month: 'short' });
        }

        function formatEstimate(estimate) {
            if (!estimate) return '';
            const val = parseFloat(estimate);
            if (val === 0.5) return 'Â½ dag';
            if (val === 1) return '1 dag';
            if (val === 1.5) return '1Â½ dag';
            if (val === 2.5) return '2Â½ d';
            if (val % 1 === 0.5) return `${Math.floor(val)}Â½ d`;
            return `${val} d`;
        }

        function formatAvailability(value) {
            const val = parseFloat(value);
            if (val % 1 === 0.5) return `${Math.floor(val)}Â½`;
            return val.toString();
        }

        function isOverdue(dateStr) {
            if (!dateStr) return false;
            const today = new Date(); today.setHours(0, 0, 0, 0);
            return new Date(dateStr) < today;
        }

        function showToast(message, type = 'success') {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.innerHTML = `
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    ${type === 'success' ? '<path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/>' : '<circle cx="12" cy="12" r="10"/><line x1="15" y1="9" x2="9" y2="15"/><line x1="9" y1="9" x2="15" y2="15"/>'}
                </svg>
                <span>${message}</span>
            `;
            container.appendChild(toast);
            setTimeout(() => toast.remove(), 3000);
        }

        function hexToRgba(hex, alpha) {
            const r = parseInt(hex.slice(1, 3), 16);
            const g = parseInt(hex.slice(3, 5), 16);
            const b = parseInt(hex.slice(5, 7), 16);
            return `rgba(${r}, ${g}, ${b}, ${alpha})`;
        }

        // ============================================
        // CAPACITY CALCULATIONS
        // ============================================

        function getTotalCapacity() {
            const project = getActiveProject();
            if (!project) return 0;
            let total = 0;
            getTeam().forEach(member => {
                total += parseFloat(project.teamAvailability[member.id]) || 0;
            });
            return total;
        }

        function getUsedCapacity() {
            const sprint = getActiveSprint();
            if (!sprint) return 0;
            return getFilteredCards().filter(c => c.status !== 'backlog').reduce((sum, c) => sum + (parseFloat(c.estimate) || 0), 0);
        }

        function getCompletedCapacity() {
            return getFilteredCards().filter(c => c.status === 'klaar').reduce((sum, c) => sum + (parseFloat(c.estimate) || 0), 0);
        }

        // ============================================
        // SPRINT DURATION & AVAILABILITY SYNC
        // ============================================

        function onSprintDaysChange() {
            const days = parseFloat(document.getElementById('sprintDaysInput').value) || 10;
            document.getElementById('defaultDaysDisplay').textContent = formatAvailability(days);
        }

        function syncAllAvailability() {
            const project = getActiveProject();
            const sprint = getActiveSprint();
            if (!project || !sprint) return;
            
            const sprintDays = parseFloat(sprint.days) || 10;
            getTeam().forEach(member => {
                project.teamAvailability[member.id] = sprintDays;
            });
            saveToStorage();
            renderTeamAvailabilityList();
            updateStats();
            showToast(`Beschikbaarheid gesynchroniseerd naar ${formatAvailability(sprintDays)} dagen`);
        }

        function syncMemberAvailability(memberId) {
            const project = getActiveProject();
            const sprint = getActiveSprint();
            if (!project || !sprint) return;
            
            const sprintDays = parseFloat(sprint.days) || 10;
            project.teamAvailability[memberId] = sprintDays;
            saveToStorage();
            renderTeamAvailabilityList();
            updateStats();
        }

        // ============================================
        // RENDER FUNCTIONS
        // ============================================

        function renderBoard() {
            const board = document.getElementById('board');
            board.innerHTML = '';

            COLUMNS.forEach(column => {
                const cards = getFilteredCards().filter(c => c.status === column.id);
                const columnEl = document.createElement('div');
                columnEl.className = 'column';
                columnEl.dataset.status = column.id;
                columnEl.ondrop = (e) => handleDrop(e, column.id);
                columnEl.ondragover = handleDragOver;
                columnEl.ondragleave = handleDragLeave;

                columnEl.innerHTML = `
                    <div class="column-header">
                        <div class="column-title">
                            <div class="column-dot" style="background: ${column.color}"></div>
                            <span class="column-name">${column.name}</span>
                        </div>
                        <span class="column-count">${cards.length}</span>
                    </div>
                    <div class="column-cards">
                        ${cards.map(renderCard).join('')}
                        <button class="add-card-btn" onclick="openCardModal(null, '${column.id}')">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/>
                            </svg>
                            Taak toevoegen
                        </button>
                    </div>
                `;
                board.appendChild(columnEl);
            });

            updateStats();
        }

        function renderCard(card) {
            const epic = getEpics().find(e => e.id === card.epicId);
            const owner = getTeam().find(t => t.id === card.ownerId);
            const participants = (card.participants || []).map(id => getTeam().find(t => t.id === id)).filter(Boolean);
            const otherParticipants = participants.filter(p => !owner || p.id !== owner.id);
            const subtasksDone = (card.subtasks || []).filter(s => s.done).length;
            const subtasksTotal = (card.subtasks || []).length;
            const subtasksPercent = subtasksTotal > 0 ? Math.round((subtasksDone / subtasksTotal) * 100) : 0;
            const hasTopRow = epic || card.priority;
            const hasMetaInfo = card.dueDate || card.estimate || otherParticipants.length > 0;

            return `
                <div class="card ${card.priority ? 'priority-' + card.priority : ''}" draggable="true" data-id="${card.id}" ondragstart="handleDragStart(event)" ondragend="handleDragEnd(event)" onclick="openCardModal('${card.id}')">
                    ${hasTopRow ? `
                        <div class="card-top-row">
                            ${epic ? `<div class="card-epic" style="background: ${hexToRgba(epic.color, 0.15)}; color: ${epic.color}">${epic.name}</div>` : '<div></div>'}
                            ${card.priority ? `<div class="card-priority-badge ${card.priority}">${card.priority === 'high' ? 'Hoog' : card.priority === 'medium' ? 'Middel' : 'Laag'}</div>` : ''}
                        </div>
                    ` : ''}
                    
                    <div class="card-title">${card.title}</div>
                    ${card.description ? `<div class="card-description">${card.description}</div>` : ''}
                    
                    ${subtasksTotal > 0 ? `
                        <div class="card-subtasks-section">
                            <div class="card-subtasks-header">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="9 11 12 14 22 4"/><path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"/></svg>
                                <span>${subtasksDone} / ${subtasksTotal}</span>
                                <span class="subtasks-percent">${subtasksPercent}%</span>
                            </div>
                            <div class="card-subtasks-bar">
                                <div class="card-subtasks-fill ${subtasksPercent === 100 ? 'complete' : ''}" style="width: ${subtasksPercent}%"></div>
                            </div>
                        </div>
                    ` : ''}
                    
                    <div class="card-actions">
                        <button class="card-action-btn delete" onclick="event.stopPropagation(); deleteCard('${card.id}')" title="Verwijderen">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                            </svg>
                        </button>
                    </div>
                    
                    ${(owner || hasMetaInfo) ? `
                        <div class="card-footer">
                            ${owner ? `
                                <div class="card-owner">
                                    <div class="card-owner-avatar" style="background: ${owner.color}">${getInitials(owner.name)}</div>
                                    <span class="card-owner-name">${owner.name}</span>
                                </div>
                            ` : ''}
                            ${hasMetaInfo ? `
                                <div class="card-meta-row">
                                    ${card.dueDate ? `<div class="card-meta ${isOverdue(card.dueDate) && card.status !== 'klaar' ? 'overdue' : ''}">
                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="4" width="18" height="18" rx="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
                                        ${formatDate(card.dueDate)}
                                    </div>` : ''}
                                    ${card.estimate ? `<div class="card-estimate">${formatEstimate(card.estimate)}</div>` : ''}
                                    ${otherParticipants.length > 0 ? `<div class="card-other-participants">
                                        <span class="other-label">+</span>
                                        ${otherParticipants.slice(0, 3).map(p => `<div class="card-avatar-small" style="background: ${p.color}" title="${p.name}">${getInitials(p.name)}</div>`).join('')}
                                        ${otherParticipants.length > 3 ? `<span class="more-participants">+${otherParticipants.length - 3}</span>` : ''}
                                    </div>` : ''}
                                </div>
                            ` : ''}
                        </div>
                    ` : ''}
                </div>
            `;
        }

        function renderTeamList() {
            const list = document.getElementById('teamList');
            list.innerHTML = getTeam().length ? getTeam().map(member => {
                const memberTasks = getCards().filter(c => c.ownerId === member.id);
                const doneTasks = memberTasks.filter(c => c.status === 'klaar').length;
                const isExpanded = state.expandedTeam && state.expandedTeam[member.id];
                
                return `
                    <div class="epic-item ${isExpanded ? 'expanded' : ''}">
                        <div class="epic-header" onclick="toggleTeamExpand('${member.id}')">
                            <div class="avatar" style="background: ${member.color}; width: 32px; height: 32px;">${getInitials(member.name)}</div>
                            <div class="epic-info">
                                <div class="epic-name">${member.name}</div>
                                <div class="epic-progress">${doneTasks}/${memberTasks.length} taken voltooid</div>
                            </div>
                            <div class="epic-actions">
                                <button class="card-action-btn" onclick="event.stopPropagation(); filterByOwner('${member.id}')" title="Filter op dit teamlid">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"/></svg>
                                </button>
                                <button class="card-action-btn delete" onclick="event.stopPropagation(); deleteTeamMember('${member.id}')" title="Verwijderen">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>
                                </button>
                                <svg class="expand-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 12 15 18 9"/></svg>
                            </div>
                        </div>
                        ${memberTasks.length > 0 ? `
                            <div class="epic-tasks">
                                ${memberTasks.map(task => {
                                    const epic = getEpics().find(e => e.id === task.epicId);
                                    const statusLabel = COLUMNS.find(c => c.id === task.status)?.name || task.status;
                                    return `
                                        <div class="epic-task-item" onclick="event.stopPropagation(); closePanel('team'); openCardModal('${task.id}')">
                                            <div class="epic-task-status status-${task.status}"></div>
                                            <div class="epic-task-info">
                                                <div class="epic-task-title">${task.title}</div>
                                                <div class="epic-task-meta">
                                                    <span class="epic-task-status-label">${statusLabel}</span>
                                                    ${epic ? `<span style="color: ${epic.color}; font-weight: 600;">${epic.name}</span>` : ''}
                                                    ${task.estimate ? `<span class="epic-task-estimate">${formatEstimate(task.estimate)}</span>` : ''}
                                                </div>
                                            </div>
                                        </div>
                                    `;
                                }).join('')}
                            </div>
                        ` : ''}
                    </div>
                `;
            }).join('') : '<div class="empty-state"><p>Nog geen teamleden toegevoegd</p></div>';
        }

        function renderTeamAvailabilityList() {
            const list = document.getElementById('teamAvailabilityList');
            const project = getActiveProject();
            const sprint = getActiveSprint();
            const sprintDays = parseFloat(sprint?.days) || 10;
            
            list.innerHTML = getTeam().length ? getTeam().map(member => {
                const availability = project?.teamAvailability[member.id] ?? sprintDays;
                const isDefault = availability === sprintDays;
                return `
                    <div class="item-row">
                        <div class="avatar" style="background: ${member.color}; width: 28px; height: 28px; font-size: 0.6875rem;">${getInitials(member.name)}</div>
                        <div class="item-info"><div class="item-name">${member.name}</div></div>
                        <div class="team-availability">
                            <input type="number" class="availability-input" value="${availability}" min="0" max="60" step="0.5" onchange="updateTeamAvailability('${member.id}', this.value)">
                            <span class="availability-label">dagen</span>
                            ${!isDefault ? `<button class="availability-sync-btn" onclick="syncMemberAvailability('${member.id}')" title="Synchroniseer met sprintduur">â†º</button>` : ''}
                        </div>
                    </div>
                `;
            }).join('') : '<div class="empty-state"><p>Voeg eerst teamleden toe via het Team panel</p></div>';
        }

        function renderEpicsList() {
            const list = document.getElementById('epicsList');
            list.innerHTML = getEpics().length ? getEpics().map(epic => {
                const epicTasks = getCards().filter(c => c.epicId === epic.id);
                const doneTasks = epicTasks.filter(c => c.status === 'klaar').length;
                const isExpanded = state.expandedEpics && state.expandedEpics[epic.id];
                
                return `
                    <div class="epic-item ${isExpanded ? 'expanded' : ''}">
                        <div class="epic-header" onclick="toggleEpicExpand('${epic.id}')">
                            <div class="epic-color" style="background: ${epic.color}"></div>
                            <div class="epic-info">
                                <div class="epic-name">${epic.name}</div>
                                <div class="epic-progress">${doneTasks}/${epicTasks.length} taken voltooid</div>
                            </div>
                            <div class="epic-actions">
                                <button class="card-action-btn" onclick="event.stopPropagation(); filterByEpic('${epic.id}')" title="Filter op deze epic">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"/></svg>
                                </button>
                                <button class="card-action-btn delete" onclick="event.stopPropagation(); deleteEpic('${epic.id}')" title="Verwijderen">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>
                                </button>
                                <svg class="expand-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 12 15 18 9"/></svg>
                            </div>
                        </div>
                        ${epicTasks.length > 0 ? `
                            <div class="epic-tasks">
                                ${epicTasks.map(task => {
                                    const owner = getTeam().find(t => t.id === task.ownerId);
                                    const statusLabel = COLUMNS.find(c => c.id === task.status)?.name || task.status;
                                    return `
                                        <div class="epic-task-item" onclick="event.stopPropagation(); closePanel('epics'); openCardModal('${task.id}')">
                                            <div class="epic-task-status status-${task.status}"></div>
                                            <div class="epic-task-info">
                                                <div class="epic-task-title">${task.title}</div>
                                                <div class="epic-task-meta">
                                                    <span class="epic-task-status-label">${statusLabel}</span>
                                                    ${owner ? `<span class="epic-task-owner">${owner.name}</span>` : ''}
                                                    ${task.estimate ? `<span class="epic-task-estimate">${formatEstimate(task.estimate)}</span>` : ''}
                                                </div>
                                            </div>
                                        </div>
                                    `;
                                }).join('')}
                            </div>
                        ` : ''}
                    </div>
                `;
            }).join('') : '<div class="empty-state"><p>Nog geen epics toegevoegd</p></div>';
        }

        function renderFilterChips() {
            // Status filter chip (when active)
            const statusGroup = document.getElementById('statusFilterGroup');
            const statusChips = document.getElementById('statusFilterChips');
            if (state.filters.status) {
                statusGroup.style.display = 'flex';
                const statusName = COLUMNS.find(c => c.id === state.filters.status)?.name || state.filters.status;
                const statusColor = COLUMNS.find(c => c.id === state.filters.status)?.color || '#64748b';
                statusChips.innerHTML = `
                    <button class="filter-chip-status active" style="--status-color: ${statusColor};" onclick="toggleFilter('status', '${state.filters.status}')">
                        <span class="status-dot" style="background: ${statusColor}"></span>
                        ${statusName}
                        <span class="chip-remove">âœ•</span>
                    </button>
                `;
            } else {
                statusGroup.style.display = 'none';
            }

            // Epic chips
            const epicGroup = document.getElementById('epicFilterGroup');
            const epicChips = document.getElementById('epicFilterChips');
            if (getEpics().length > 0) {
                epicGroup.style.display = 'flex';
                epicChips.innerHTML = getEpics().map(epic => `
                    <button class="filter-chip-epic ${state.filters.epic === epic.id ? 'active' : ''}" style="--epic-color: ${epic.color};" onclick="toggleFilter('epic', '${epic.id}')">
                        <style>.filter-chip-epic[style*="${epic.color}"]::before { background: ${epic.color}; }</style>
                        ${epic.name}
                    </button>
                `).join('');
            } else {
                epicGroup.style.display = 'none';
            }

            // Team chips
            const teamGroup = document.getElementById('teamFilterGroup');
            const teamChips = document.getElementById('teamFilterChips');
            if (getTeam().length > 0) {
                teamGroup.style.display = 'flex';
                teamChips.innerHTML = getTeam().map(member => `
                    <button class="filter-chip-team ${state.filters.owner === member.id ? 'active' : ''}" onclick="toggleFilter('owner', '${member.id}')">
                        <span class="mini-avatar" style="background: ${member.color}">${getInitials(member.name)}</span>
                        ${member.name}
                    </button>
                `).join('');
            } else {
                teamGroup.style.display = 'none';
            }

            // Clear filters button
            const hasActiveFilters = state.filters.epic || state.filters.owner || state.filters.search || state.filters.status;
            document.getElementById('clearFiltersBtn').style.display = hasActiveFilters ? 'block' : 'none';
        }

        function renderParticipantCheckboxes() {
            const container = document.getElementById('participantsContainer');
            container.innerHTML = getTeam().length ? getTeam().map(member => `
                <label class="participant-item">
                    <input type="checkbox" value="${member.id}">
                    <div class="avatar" style="background: ${member.color}; width: 22px; height: 22px; font-size: 0.5625rem;">${getInitials(member.name)}</div>
                    <span style="font-size: 0.8125rem; color: var(--slate-700);">${member.name}</span>
                </label>
            `).join('') : '<p style="color: var(--slate-400); font-size: 0.8125rem;">Voeg eerst teamleden toe</p>';
        }

        function renderSubtasks() {
            const container = document.getElementById('subtasksContainer');
            container.innerHTML = state.currentEditSubtasks.map((subtask, index) => `
                <div class="checklist-item ${subtask.done ? 'done' : ''}">
                    <input type="checkbox" ${subtask.done ? 'checked' : ''} onchange="toggleSubtask(${index})">
                    <span>${subtask.text}</span>
                    <button class="card-action-btn" onclick="removeSubtask(${index})" style="width: 20px; height: 20px;">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width: 10px; height: 10px;"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
                    </button>
                </div>
            `).join('');
        }

        function updateStats() {
            const sprint = getActiveSprint();
            const cards = getFilteredCards();
            const total = cards.length;
            const done = cards.filter(c => c.status === 'klaar').length;
            const totalCapacity = getTotalCapacity();
            const usedCapacity = getUsedCapacity();
            const completedCapacity = getCompletedCapacity();
            const remaining = totalCapacity - usedCapacity;

            document.getElementById('statTotalTasks').textContent = total;
            document.getElementById('statCompletedTasks').textContent = done;

            const capacityPercentage = totalCapacity > 0 ? Math.min((usedCapacity / totalCapacity) * 100, 100) : 0;
            const capacityFill = document.getElementById('capacityFill');
            const capacityText = document.getElementById('capacityText');

            capacityFill.style.width = `${capacityPercentage}%`;
            capacityText.textContent = `${usedCapacity} / ${totalCapacity} dagen`;

            let statusClass = 'under';
            if (usedCapacity > totalCapacity) statusClass = 'over';
            else if (capacityPercentage > 85) statusClass = 'warning';

            capacityFill.className = `capacity-fill ${statusClass}`;
            capacityText.className = `capacity-text ${statusClass}`;

            document.getElementById('panelStatTotal').textContent = total;
            document.getElementById('panelStatDone').textContent = done;
            document.getElementById('panelStatDays').textContent = usedCapacity;
            document.getElementById('panelStatDaysDone').textContent = completedCapacity;

            document.getElementById('panelCapacityTotal').textContent = totalCapacity;
            document.getElementById('panelCapacityUsed').textContent = usedCapacity;
            document.getElementById('panelCapacityRemaining').textContent = remaining >= 0 ? remaining : remaining.toFixed(1);

            if (sprint) {
                document.getElementById('defaultDaysDisplay').textContent = formatAvailability(sprint.days || 10);
            }
        }

        function updateSelects() {
            document.getElementById('cardEpicSelect').innerHTML = '<option value="">Geen epic</option>' +
                getEpics().map(e => `<option value="${e.id}">${e.name}</option>`).join('') +
                '<option value="__new__">+ Nieuwe epic aanmaken...</option>';

            document.getElementById('cardOwnerSelect').innerHTML = '<option value="">Niet toegewezen</option>' +
                getTeam().map(t => `<option value="${t.id}">${t.name}</option>`).join('');
        }

        // ============================================
        // FILTER FUNCTIONS
        // ============================================

        function getFilteredCards() {
            const project = getActiveProject();
            const sprint = getActiveSprint();
            if (!project || !sprint) return [];
            
            return project.cards.filter(card => {
                // Filter by sprint
                if (card.sprintId !== sprint.id) return false;
                
                if (state.filters.search) {
                    const search = state.filters.search.toLowerCase();
                    if (!card.title.toLowerCase().includes(search) && !(card.description || '').toLowerCase().includes(search)) return false;
                }
                if (state.filters.epic && card.epicId !== state.filters.epic) return false;
                if (state.filters.owner && card.ownerId !== state.filters.owner) return false;
                if (state.filters.status && card.status !== state.filters.status) return false;
                return true;
            });
        }

        function filterCards() {
            state.filters.search = document.getElementById('searchInput').value;
            renderBoard();
            renderFilterChips();
        }

        function toggleFilter(type, value) {
            state.filters[type] = state.filters[type] === value ? null : value;
            renderFilterChips();
            renderBoard();
        }

        function clearAllFilters() {
            state.filters = { search: '', epic: null, owner: null, status: null };
            document.getElementById('searchInput').value = '';
            renderFilterChips();
            renderBoard();
        }

        // ============================================
        // DRAG & DROP
        // ============================================

        let draggedCard = null;

        function handleDragStart(e) {
            draggedCard = e.target;
            e.target.classList.add('dragging');
            e.dataTransfer.effectAllowed = 'move';
        }

        function handleDragEnd(e) {
            e.target.classList.remove('dragging');
            document.querySelectorAll('.column').forEach(col => col.classList.remove('drag-over'));
            draggedCard = null;
        }

        function handleDragOver(e) {
            e.preventDefault();
            e.currentTarget.classList.add('drag-over');
        }

        function handleDragLeave(e) {
            e.currentTarget.classList.remove('drag-over');
        }

        function handleDrop(e, status) {
            e.preventDefault();
            e.currentTarget.classList.remove('drag-over');
            if (draggedCard) {
                const card = getCards().find(c => c.id === draggedCard.dataset.id);
                if (card) {
                    card.status = status;
                    saveToStorage();
                    renderBoard();
                    showToast('Taak verplaatst');
                }
            }
        }

        // ============================================
        // CARD OPERATIONS
        // ============================================

        function openCardModal(cardId = null, defaultStatus = 'todo') {
            updateSelects();
            renderParticipantCheckboxes();
            document.getElementById('addEpicInline').classList.remove('active');

            if (cardId) {
                const card = getCards().find(c => c.id === cardId);
                if (card) {
                    document.getElementById('cardModalTitle').textContent = 'Taak Bewerken';
                    document.getElementById('cardId').value = card.id;
                    document.getElementById('cardTitle').value = card.title;
                    document.getElementById('cardDescription').value = card.description || '';
                    document.getElementById('cardEpicSelect').value = card.epicId || '';
                    document.getElementById('cardStatus').value = card.status;
                    document.getElementById('cardOwnerSelect').value = card.ownerId || '';
                    // Convert ISO to dd/mm/jjjj for display
                    document.getElementById('cardDueDate').value = card.dueDate ? toDisplayDate(card.dueDate) : '';
                    document.getElementById('cardEstimate').value = card.estimate || '';
                    state.currentEditSubtasks = (card.subtasks || []).map(s => ({...s}));

                    // Set priority buttons
                    document.querySelectorAll('.priority-btn').forEach(btn => btn.classList.remove('active'));
                    if (card.priority) document.querySelector(`.priority-btn.${card.priority}`).classList.add('active');

                    // Set estimate slider
                    const estVal = parseFloat(card.estimate) || 0;
                    document.getElementById('cardEstimateSlider').value = Math.min(estVal, 40);
                    document.getElementById('estimateCustomInput').value = estVal > 0 ? estVal : '';
                    updateEstimateDisplay(estVal);

                    // Set participant checkboxes
                    setTimeout(() => {
                        document.querySelectorAll('#participantsContainer input[type="checkbox"]').forEach(cb => {
                            cb.checked = (card.participants || []).includes(cb.value);
                        });
                    }, 0);
                }
            } else {
                document.getElementById('cardModalTitle').textContent = 'Nieuwe Taak';
                document.getElementById('cardId').value = '';
                document.getElementById('cardTitle').value = '';
                document.getElementById('cardDescription').value = '';
                document.getElementById('cardEpicSelect').value = '';
                document.getElementById('cardStatus').value = defaultStatus;
                document.getElementById('cardOwnerSelect').value = '';
                document.getElementById('cardDueDate').value = '';
                document.getElementById('cardEstimate').value = '';
                document.getElementById('cardEstimateSlider').value = 0;
                document.getElementById('estimateCustomInput').value = '';
                updateEstimateDisplay(0);
                document.querySelectorAll('.priority-btn').forEach(btn => btn.classList.remove('active'));
                document.querySelectorAll('#participantsContainer input[type="checkbox"]').forEach(cb => cb.checked = false);
                state.currentEditSubtasks = [];
            }

            renderSubtasks();
            document.getElementById('cardModalOverlay').classList.add('active');
            document.getElementById('cardModal').classList.add('active');
            setTimeout(() => document.getElementById('cardTitle').focus(), 100);
        }

        function closeCardModal() {
            document.getElementById('cardModalOverlay').classList.remove('active');
            document.getElementById('cardModal').classList.remove('active');
        }

        function saveCard() {
            const project = getActiveProject();
            const sprint = getActiveSprint();
            if (!project || !sprint) return;
            
            const title = document.getElementById('cardTitle').value.trim();
            if (!title) { showToast('Vul een titel in', 'error'); return; }

            // Convert due date from dd/mm/jjjj to ISO
            const dueDateInput = document.getElementById('cardDueDate').value;
            const dueDate = dueDateInput ? toIsoDate(dueDateInput) : null;
            
            if (dueDateInput && !dueDate) {
                showToast('Ongeldige deadline. Gebruik dd/mm/jjjj', 'error');
                return;
            }

            const cardId = document.getElementById('cardId').value;
            const cardData = {
                id: cardId || generateId(),
                title,
                description: document.getElementById('cardDescription').value.trim(),
                epicId: document.getElementById('cardEpicSelect').value || null,
                status: document.getElementById('cardStatus').value,
                ownerId: document.getElementById('cardOwnerSelect').value || null,
                dueDate: dueDate,
                estimate: document.getElementById('cardEstimate').value || null,
                priority: document.querySelector('.priority-btn.active')?.classList.contains('high') ? 'high' :
                          document.querySelector('.priority-btn.active')?.classList.contains('medium') ? 'medium' :
                          document.querySelector('.priority-btn.active')?.classList.contains('low') ? 'low' : null,
                participants: [...document.querySelectorAll('#participantsContainer input:checked')].map(cb => cb.value),
                subtasks: state.currentEditSubtasks.map(s => ({...s})),
                sprintId: sprint.id
            };

            if (cardId) {
                const index = project.cards.findIndex(c => c.id === cardId);
                if (index !== -1) {
                    cardData.sprintId = project.cards[index].sprintId; // Keep original sprint
                    project.cards[index] = cardData;
                }
            } else {
                project.cards.push(cardData);
            }

            saveToStorage();
            renderBoard();
            renderSprintTabs();
            closeCardModal();
            showToast(cardId ? 'Taak bijgewerkt' : 'Taak aangemaakt');
        }

        function deleteCard(cardId) {
            const project = getActiveProject();
            if (!project) return;
            
            if (confirm('Weet je zeker dat je deze taak wilt verwijderen?')) {
                project.cards = project.cards.filter(c => c.id !== cardId);
                saveToStorage();
                renderBoard();
                renderSprintTabs();
                showToast('Taak verwijderd');
            }
        }

        function setPriority(priority) {
            document.querySelectorAll('.priority-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelector(`.priority-btn.${priority}`).classList.add('active');
        }

        function setEstimate(value) {
            const val = parseFloat(value) || 0;
            document.getElementById('cardEstimate').value = val > 0 ? val : '';
            document.getElementById('cardEstimateSlider').value = Math.min(val, 40);
            updateEstimateDisplay(val);
        }

        function updateEstimateFromSlider(value) {
            const val = parseFloat(value) || 0;
            document.getElementById('cardEstimate').value = val > 0 ? val : '';
            document.getElementById('estimateCustomInput').value = val > 0 ? val : '';
            updateEstimateDisplay(val);
        }

        function setEstimateFromInput(value) {
            const val = parseFloat(value) || 0;
            document.getElementById('cardEstimate').value = val > 0 ? val : '';
            document.getElementById('cardEstimateSlider').value = Math.min(val, 40);
            updateEstimateDisplay(val);
        }

        function updateEstimateDisplay(value) {
            const display = document.getElementById('estimateDisplay');
            if (!value || value === 0) {
                display.textContent = '-';
            } else {
                display.textContent = formatEstimate(value);
            }
        }

        function onOwnerChange(ownerId) {
            if (ownerId) {
                // Vink de eigenaar ook aan als betrokkene
                const checkbox = document.querySelector(`#participantsContainer input[value="${ownerId}"]`);
                if (checkbox) {
                    checkbox.checked = true;
                }
            }
        }

        function handleEpicSelect(select) {
            if (select.value === '__new__') {
                select.value = '';
                document.getElementById('addEpicInline').classList.add('active');
                document.getElementById('inlineEpicName').focus();
            }
        }

        function addEpicInline() {
            const project = getActiveProject();
            if (!project) return;
            
            const name = document.getElementById('inlineEpicName').value.trim();
            const color = document.getElementById('inlineEpicColor').value;
            if (!name) { showToast('Vul een epic naam in', 'error'); return; }

            const newEpic = { id: generateId(), name, color };
            project.epics.push(newEpic);
            saveToStorage();
            updateSelects();
            document.getElementById('cardEpicSelect').value = newEpic.id;
            document.getElementById('inlineEpicName').value = '';
            document.getElementById('addEpicInline').classList.remove('active');
            renderFilterChips();
            showToast('Epic aangemaakt');
        }

        function addSubtask() {
            const input = document.getElementById('newSubtaskInput');
            const text = input.value.trim();
            if (text) {
                state.currentEditSubtasks.push({ text, done: false });
                input.value = '';
                renderSubtasks();
            }
        }

        function toggleSubtask(index) {
            state.currentEditSubtasks[index].done = !state.currentEditSubtasks[index].done;
            renderSubtasks();
        }

        function removeSubtask(index) {
            state.currentEditSubtasks.splice(index, 1);
            renderSubtasks();
        }

        function addTeamMember() {
            const project = getActiveProject();
            const sprint = getActiveSprint();
            if (!project) return;
            
            const name = document.getElementById('newMemberName').value.trim();
            const color = document.getElementById('newMemberColor').value;
            if (!name) { showToast('Vul een naam in', 'error'); return; }

            const newMember = { id: generateId(), name, color };
            project.team.push(newMember);
            // Automatically set availability based on sprint duration
            project.teamAvailability[newMember.id] = parseFloat(sprint?.days) || 10;
            document.getElementById('newMemberName').value = '';
            document.getElementById('newMemberColor').value = AVATAR_COLORS[Math.floor(Math.random() * AVATAR_COLORS.length)];
            saveToStorage();
            renderTeamList();
            renderTeamAvailabilityList();
            renderFilterChips();
            updateStats();
            showToast('Teamlid toegevoegd');
        }

        function deleteTeamMember(memberId) {
            const project = getActiveProject();
            if (!project) return;
            
            if (confirm('Weet je zeker dat je dit teamlid wilt verwijderen?')) {
                project.team = project.team.filter(t => t.id !== memberId);
                delete project.teamAvailability[memberId];
                project.cards.forEach(card => {
                    if (card.ownerId === memberId) card.ownerId = null;
                    card.participants = (card.participants || []).filter(p => p !== memberId);
                });
                saveToStorage();
                renderTeamList();
                renderTeamAvailabilityList();
                renderFilterChips();
                renderBoard();
                showToast('Teamlid verwijderd');
            }
        }

        function updateTeamAvailability(memberId, value) {
            const project = getActiveProject();
            if (!project) return;
            
            project.teamAvailability[memberId] = parseFloat(value) || 0;
            saveToStorage();
            renderTeamAvailabilityList();
            updateStats();
        }

        function addEpic() {
            const project = getActiveProject();
            if (!project) return;
            
            const name = document.getElementById('newEpicName').value.trim();
            const color = document.getElementById('newEpicColor').value;
            if (!name) { showToast('Vul een naam in', 'error'); return; }

            project.epics.push({ id: generateId(), name, color });
            document.getElementById('newEpicName').value = '';
            document.getElementById('newEpicColor').value = AVATAR_COLORS[Math.floor(Math.random() * AVATAR_COLORS.length)];
            saveToStorage();
            renderEpicsList();
            renderFilterChips();
            showToast('Epic toegevoegd');
        }

        function deleteEpic(epicId) {
            const project = getActiveProject();
            if (!project) return;
            
            if (confirm('Weet je zeker dat je deze epic wilt verwijderen?')) {
                project.epics = project.epics.filter(e => e.id !== epicId);
                project.cards.forEach(card => { if (card.epicId === epicId) card.epicId = null; });
                saveToStorage();
                renderEpicsList();
                renderFilterChips();
                renderBoard();
                showToast('Epic verwijderd');
            }
        }

        function toggleEpicExpand(epicId) {
            state.expandedEpics[epicId] = !state.expandedEpics[epicId];
            renderEpicsList();
        }

        function filterByEpic(epicId) {
            state.filters.epic = epicId;
            closePanel('epics');
            renderBoard();
            renderFilterChips();
            showToast('Gefilterd op epic');
        }

        function toggleTeamExpand(memberId) {
            state.expandedTeam[memberId] = !state.expandedTeam[memberId];
            renderTeamList();
        }

        function filterByOwner(memberId) {
            state.filters.owner = memberId;
            closePanel('team');
            renderBoard();
            renderFilterChips();
            showToast('Gefilterd op teamlid');
        }

        function showTasksOverview(type) {
            // Clear other filters first
            state.filters.epic = null;
            state.filters.owner = null;
            state.filters.search = '';
            document.getElementById('searchInput').value = '';
            
            if (type === 'done') {
                state.filters.status = 'klaar';
                showToast('Voltooide taken weergegeven');
            } else if (type === 'all') {
                state.filters.status = null;
                showToast('Alle taken weergegeven');
            }
            
            renderBoard();
            renderFilterChips();
        }

        function saveSprint() {
            const sprint = getActiveSprint();
            if (!sprint) return;
            
            const startInput = document.getElementById('sprintStartInput').value;
            const endInput = document.getElementById('sprintEndInput').value;
            
            // Convert dd/mm/jjjj to ISO format
            const startDate = toIsoDate(startInput);
            const endDate = toIsoDate(endInput);
            
            // Validate dates if entered
            if (startInput && !startDate) {
                showToast('Ongeldige startdatum. Gebruik dd/mm/jjjj', 'error');
                return;
            }
            if (endInput && !endDate) {
                showToast('Ongeldige einddatum. Gebruik dd/mm/jjjj', 'error');
                return;
            }
            
            sprint.name = document.getElementById('sprintNameInput').value || 'Sprint 1';
            sprint.startDate = startDate;
            sprint.endDate = endDate;
            sprint.days = parseFloat(document.getElementById('sprintDaysInput').value) || 10;
            sprint.goal = document.getElementById('sprintGoalInput').value;
            
            saveToStorage();
            renderSprintTabs();
            updateSprintInfo();
            renderTeamAvailabilityList();
            updateStats();
            showToast('Sprint opgeslagen');
        }

        function loadSprintSettings() {
            const sprint = getActiveSprint();
            if (!sprint) return;
            
            document.getElementById('sprintNameInput').value = sprint.name || '';
            // Convert ISO to dd/mm/jjjj for display
            document.getElementById('sprintStartInput').value = sprint.startDate ? toDisplayDate(sprint.startDate) : '';
            document.getElementById('sprintEndInput').value = sprint.endDate ? toDisplayDate(sprint.endDate) : '';
            document.getElementById('sprintDaysInput').value = sprint.days || 10;
            document.getElementById('sprintGoalInput').value = sprint.goal || '';
            document.getElementById('defaultDaysDisplay').textContent = formatAvailability(sprint.days || 10);
        }

        // ============================================
        // PANEL & DROPDOWN
        // ============================================

        function openPanel(panel) {
            document.getElementById(`${panel}Overlay`).classList.add('active');
            document.getElementById(`${panel}Panel`).classList.add('active');
            if (panel === 'team') renderTeamList();
            if (panel === 'epics') renderEpicsList();
            if (panel === 'sprint') { loadSprintSettings(); renderTeamAvailabilityList(); }
        }

        function closePanel(panel) {
            document.getElementById(`${panel}Overlay`).classList.remove('active');
            document.getElementById(`${panel}Panel`).classList.remove('active');
        }

        function toggleDropdown(id) {
            const dropdown = document.getElementById(id);
            const parent = dropdown.closest('.dropdown') || dropdown.parentElement;
            
            // Close all other dropdowns
            document.querySelectorAll('.dropdown-menu.active').forEach(d => {
                if (d.id !== id) d.classList.remove('active');
            });
            document.querySelectorAll('.dropdown.active').forEach(d => {
                if (!d.contains(dropdown)) d.classList.remove('active');
            });
            
            dropdown.classList.toggle('active');
            if (parent) parent.classList.toggle('active');
        }

        function closeDropdown(id) {
            const dropdown = document.getElementById(id);
            const parent = dropdown.closest('.dropdown') || dropdown.parentElement;
            dropdown.classList.remove('active');
            if (parent) parent.classList.remove('active');
        }

        document.addEventListener('click', (e) => {
            if (!e.target.closest('.dropdown') && !e.target.closest('.project-selector')) {
                document.querySelectorAll('.dropdown').forEach(d => d.classList.remove('active'));
                document.querySelectorAll('.dropdown-menu').forEach(d => d.classList.remove('active'));
            }
        });

        // ============================================
        // EXPORT & IMPORT FUNCTIONS
        // ============================================

        function exportAsJSON() {
            try {
                const project = getActiveProject();
                if (!project) return;
                
                const dataToExport = {
                    version: 'sprintflow_v5',
                    exportDate: new Date().toISOString(),
                    projectName: project.name,
                    data: {
                        project: project
                    }
                };
                const json = JSON.stringify(dataToExport, null, 2);
                const blob = new Blob([json], { type: 'application/json' });
                const link = document.createElement('a');
                link.href = URL.createObjectURL(blob);
                link.download = `sprintflow-${project.name.replace(/[^a-z0-9]/gi, '-')}-${new Date().toISOString().split('T')[0]}.json`;
                link.click();
                showToast('Backup opgeslagen');
            } catch (error) {
                showToast('Export mislukt', 'error');
                console.error(error);
            }
        }

        function importFromJSON(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const imported = JSON.parse(e.target.result);
                    
                    // Handle both old and new format
                    let importedProject;
                    
                    if (imported.data?.project) {
                        // New v5 format
                        importedProject = imported.data.project;
                    } else if (imported.data?.cards) {
                        // Old v4 format - convert to project
                        importedProject = createDefaultProject();
                        importedProject.name = 'GeÃ¯mporteerd Project';
                        importedProject.cards = (imported.data.cards || []).map(c => ({...c, sprintId: importedProject.sprints[0].id}));
                        importedProject.team = imported.data.team || [];
                        importedProject.epics = imported.data.epics || [];
                        importedProject.teamAvailability = imported.data.teamAvailability || {};
                        if (imported.data.sprint) {
                            importedProject.sprints[0] = {...importedProject.sprints[0], ...imported.data.sprint};
                        }
                    } else {
                        throw new Error('Ongeldig bestandsformaat');
                    }

                    // Confirm import
                    const taskCount = importedProject.cards?.length || 0;
                    const teamCount = importedProject.team?.length || 0;
                    const epicCount = importedProject.epics?.length || 0;
                    
                    const action = confirm(`Hoe wil je importeren?\n\nâ€¢ ${taskCount} taken\nâ€¢ ${teamCount} teamleden\nâ€¢ ${epicCount} epics\n\nBackup van: ${imported.exportDate ? new Date(imported.exportDate).toLocaleString('nl-NL') : 'onbekend'}\n\nKlik OK om als NIEUW project te importeren\nKlik Annuleren om te annuleren`);
                    
                    if (!action) {
                        event.target.value = '';
                        return;
                    }

                    // Import as new project with new ID
                    importedProject.id = generateId();
                    importedProject.name = imported.projectName || importedProject.name || 'GeÃ¯mporteerd Project';
                    
                    // Ensure sprints have IDs
                    importedProject.sprints.forEach(s => {
                        if (!s.id) s.id = generateId();
                    });
                    
                    state.projects.push(importedProject);
                    state.activeProjectId = importedProject.id;
                    state.activeSprintId = importedProject.sprints[0]?.id;

                    // Save to localStorage and refresh UI
                    saveToStorage();
                    refreshUI();

                    showToast('Project geÃ¯mporteerd!');
                } catch (error) {
                    showToast('Kon bestand niet laden: ' + error.message, 'error');
                    console.error(error);
                }
                event.target.value = '';
            };
            reader.readAsText(file);
        }

        async function exportAsJPG() {
            try {
                showToast('Bezig met exporteren...');
                const canvas = await html2canvas(document.querySelector('.board-container'), { backgroundColor: '#f1f5f9', scale: 2 });
                const link = document.createElement('a');
                link.download = `kanban-bord-${new Date().toISOString().split('T')[0]}.jpg`;
                link.href = canvas.toDataURL('image/jpeg', 0.9);
                link.click();
                showToast('JPG geÃ«xporteerd');
            } catch (error) { showToast('Export mislukt', 'error'); }
        }

        async function exportAsPDF() {
            try {
                showToast('Bezig met exporteren...');
                const canvas = await html2canvas(document.querySelector('.board-container'), { backgroundColor: '#f1f5f9', scale: 2 });
                const { jsPDF } = window.jspdf;
                const pdf = new jsPDF({ orientation: 'landscape', unit: 'mm' });
                const imgWidth = 280;
                const imgHeight = (canvas.height * imgWidth) / canvas.width;
                pdf.addImage(canvas.toDataURL('image/jpeg', 0.9), 'JPEG', 10, 10, imgWidth, imgHeight);
                pdf.save(`kanban-bord-${new Date().toISOString().split('T')[0]}.pdf`);
                showToast('PDF geÃ«xporteerd');
            } catch (error) { showToast('Export mislukt', 'error'); }
        }

        function exportAsCSV() {
            try {
                const headers = ['ID', 'Titel', 'Beschrijving', 'Status', 'Epic', 'Eigenaar', 'Betrokkenen', 'Prioriteit', 'Inschatting', 'Deadline', 'Subtaken'];
                const rows = getCards().map(card => {
                    const epic = getEpics().find(e => e.id === card.epicId);
                    const owner = getTeam().find(t => t.id === card.ownerId);
                    const participants = (card.participants || []).map(id => getTeam().find(t => t.id === id)?.name).filter(Boolean).join('; ');
                    const subtasks = (card.subtasks || []).map(s => `${s.done ? 'âœ“' : 'â—‹'} ${s.text}`).join('; ');
                    return [card.id, `"${card.title.replace(/"/g, '""')}"`, `"${(card.description || '').replace(/"/g, '""')}"`, card.status, epic?.name || '', owner?.name || '', `"${participants}"`, card.priority, card.estimate || '', card.dueDate || '', `"${subtasks}"`].join(',');
                });
                const csv = [headers.join(','), ...rows].join('\n');
                const blob = new Blob(['\ufeff' + csv], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement('a');
                link.href = URL.createObjectURL(blob);
                link.download = `kanban-bord-${new Date().toISOString().split('T')[0]}.csv`;
                link.click();
                showToast('CSV geÃ«xporteerd');
            } catch (error) { showToast('Export mislukt', 'error'); }
        }

        // ============================================
        // KEYBOARD HANDLERS & INIT
        // ============================================

        function setupKeyboardHandlers() {
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') { closeCardModal(); closePanel('team'); closePanel('epics'); closePanel('sprint'); }
                if (e.key === 'n' && e.ctrlKey) { e.preventDefault(); openCardModal(); }
            });
            document.getElementById('newSubtaskInput').addEventListener('keypress', (e) => { if (e.key === 'Enter') { e.preventDefault(); addSubtask(); } });
            document.getElementById('newMemberName').addEventListener('keypress', (e) => { if (e.key === 'Enter') { e.preventDefault(); addTeamMember(); } });
            document.getElementById('newEpicName').addEventListener('keypress', (e) => { if (e.key === 'Enter') { e.preventDefault(); addEpic(); } });
            document.getElementById('inlineEpicName').addEventListener('keypress', (e) => { if (e.key === 'Enter') { e.preventDefault(); addEpicInline(); } });
        }

        function init() {
            loadFromStorage();
            renderProjectList();
            renderSprintTabs();
            renderBoard();
            renderFilterChips();
            updateStats();
            updateSprintInfo();
            setupKeyboardHandlers();
        }

        init();
    </script>
</body>
</html>
